!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.COS=t():e.COS=t()}(this,(function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s=14)}([function(e,t){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";(function(t){var o=r(0);function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=Array(t);r<t;r++)o[r]=e[r];return o}var a=r(17),s=r(19),c=r(20),u=c.XMLParser,l=c.XMLBuilder,d=new u({ignoreDeclaration:!0,ignoreAttributes:!0,parseTagValue:!1,trimValues:!1}),p=new l,f=r(30),h=r(7),g=function(e){if(O(e))for(var t in e){var r=e[t];"string"==typeof r?"#text"===t&&delete e[t]:Array.isArray(r)?r.forEach((function(e){g(e)})):O(r)&&g(r)}};function m(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")}function y(e,t){var r=[];for(var o in e)e.hasOwnProperty(o)&&r.push(t?m(o).toLowerCase():o);return r.sort((function(e,t){return(e=e.toLowerCase())===(t=t.toLowerCase())?0:e>t?1:-1}))}var k,C=["cache-control","content-disposition","content-encoding","content-length","content-md5","content-type","expect","expires","host","if-match","if-modified-since","if-none-match","if-unmodified-since","origin","range","transfer-encoding","pic-operations"],v=function(e,t,r){var o=t/8,n=e.slice(r,r+o);return new Uint8Array(n).reverse(),new{8:Uint8Array,16:Uint16Array,32:Uint32Array}[t](n)[0]},b=function(e,t,r,o){var n=e.slice(t,r),i="";return new Uint8Array(n).forEach((function(e){i+=String.fromCharCode(e)})),o&&(i=decodeURIComponent(escape(i))),i},S=function(){},R=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&void 0!==e[r]&&null!==e[r]&&(t[r]=e[r]);return t},x=function(e,t){var r,o=new FileReader;FileReader.prototype.readAsBinaryString?(r=FileReader.prototype.readAsBinaryString,o.onload=function(){t(this.result)}):FileReader.prototype.readAsArrayBuffer&&(r=function(e){var r="",o=new FileReader;o.onload=function(e){for(var n=new Uint8Array(o.result),i=n.byteLength,a=0;a<i;a++)r+=String.fromCharCode(n[a]);t(r)},o.readAsArrayBuffer(e)}),r.call(o,e)},T=(k=function(e,t){e=e.split("."),t=t.split(".");for(var r=0;r<t.length;r++)if(e[r]!==t[r])return parseInt(e[r])>parseInt(t[r])?1:-1;return 0},function(e){if(!e)return!1;var t=(e.match(/Chrome\/([.\d]+)/)||[])[1],r=(e.match(/QBCore\/([.\d]+)/)||[])[1],o=(e.match(/QQBrowser\/([.\d]+)/)||[])[1];return t&&k(t,"53.0.2785.116")<0&&r&&k(r,"3.53.991.400")<0&&o&&k(o,"9.0.2524.400")<=0||!1}("undefined"!=typeof navigator&&navigator.userAgent)),B=1048576;function A(e){return I(e,(function(e){return"object"===o(e)&&null!==e?A(e):e}))}function E(e,t){return w(t,(function(r,o){e[o]=t[o]})),e}function P(e){return e instanceof Array}function O(e){return"[object Object]"===Object.prototype.toString.call(e)}function w(e,t){for(var r in e)e.hasOwnProperty(r)&&t(e[r],r)}function I(e,t){var r=P(e)?[]:{};for(var o in e)e.hasOwnProperty(o)&&(r[o]=t(e[o],o));return r}var U=function(e,t){var r=t.Bucket,o=t.Region,n=t.Key,i=this.options.Domain,a=!i||"string"==typeof i&&i.indexOf("{Bucket}")>-1,s=!i||"string"==typeof i&&i.indexOf("{Region}")>-1;if(e.indexOf("Bucket")>-1||"deleteMultipleObject"===e||"multipartList"===e||"listObjectVersions"===e){if(a&&!r)return"Bucket";if(s&&!o)return"Region"}else if(e.indexOf("Object")>-1||e.indexOf("multipart")>-1||"sliceUploadFile"===e||"abortUploadTask"===e||"uploadFile"===e){if(a&&!r)return"Bucket";if(s&&!o)return"Region";if(!n)return"Key"}return!1},N=function(e,t){if(t=E({},t),"getAuth"!==e&&"getV4Auth"!==e&&"getObjectUrl"!==e){var r=t.Headers||{};if(t&&"object"===o(t)){!function(){for(var e in t)t.hasOwnProperty(e)&&e.indexOf("x-cos-")>-1&&(r[e]=t[e])}();j.each({"x-cos-mfa":"MFA","Content-MD5":"ContentMD5","Content-Length":"ContentLength","Content-Type":"ContentType",Expect:"Expect",Expires:"Expires","Cache-Control":"CacheControl","Content-Disposition":"ContentDisposition","Content-Encoding":"ContentEncoding",Range:"Range","If-Modified-Since":"IfModifiedSince","If-Unmodified-Since":"IfUnmodifiedSince","If-Match":"IfMatch","If-None-Match":"IfNoneMatch","x-cos-copy-source":"CopySource","x-cos-copy-source-Range":"CopySourceRange","x-cos-metadata-directive":"MetadataDirective","x-cos-copy-source-If-Modified-Since":"CopySourceIfModifiedSince","x-cos-copy-source-If-Unmodified-Since":"CopySourceIfUnmodifiedSince","x-cos-copy-source-If-Match":"CopySourceIfMatch","x-cos-copy-source-If-None-Match":"CopySourceIfNoneMatch","x-cos-acl":"ACL","x-cos-grant-read":"GrantRead","x-cos-grant-write":"GrantWrite","x-cos-grant-full-control":"GrantFullControl","x-cos-grant-read-acp":"GrantReadAcp","x-cos-grant-write-acp":"GrantWriteAcp","x-cos-storage-class":"StorageClass","x-cos-traffic-limit":"TrafficLimit","x-cos-mime-limit":"MimeLimit","x-cos-server-side-encryption-customer-algorithm":"SSECustomerAlgorithm","x-cos-server-side-encryption-customer-key":"SSECustomerKey","x-cos-server-side-encryption-customer-key-MD5":"SSECustomerKeyMD5","x-cos-server-side-encryption":"ServerSideEncryption","x-cos-server-side-encryption-cos-kms-key-id":"SSEKMSKeyId","x-cos-server-side-encryption-context":"SSEContext","Pic-Operations":"PicOperations","x-cos-callback":"Callback","x-cos-callback-var":"CallbackVar","x-cos-return-body":"ReturnBody"},(function(e,o){void 0!==t[e]&&(r[o]=t[e])})),t.Headers=R(r)}}return t},_=function(e){return Date.now()+(e||0)},D="object"===("undefined"==typeof navigator?"undefined":o(navigator))&&!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),L="object"===("undefined"==typeof navigator?"undefined":o(navigator))&&/\sQQ/i.test(navigator.userAgent),j={noop:S,formatParams:N,apiWrapper:function(e,t){return function(r,o){var n,i=this;if("function"==typeof r&&(o=r,r={}),r=N(e,r),i.options.EnableReporter)if("sliceUploadFile"===r.calledBySdk||"sliceCopyFile"===r.calledBySdk)n=r.tracker&&r.tracker.generateSubTracker({apiName:e});else if(["uploadFile","uploadFiles"].includes(e))n=null;else{var a=0;r.Body&&(a="string"==typeof r.Body?r.Body.length:r.Body.size||r.Body.byteLength||0);var s=i.options.UseAccelerate||"string"==typeof i.options.Domain&&i.options.Domain.includes("accelerate.");n=new h({Beacon:i.options.BeaconReporter,clsReporter:i.options.ClsReporter,bucket:r.Bucket,region:r.Region,apiName:e,realApi:e,accelerate:s,fileKey:r.Key,fileSize:a,deepTracker:i.options.DeepTracker,customId:i.options.CustomId,delay:i.options.TrackerDelay})}r.tracker=n;var c=function(e){return e&&e.headers&&(e.headers["x-ci-request-id"]&&(e.RequestId=e.headers["x-ci-request-id"]),e.headers["x-cos-request-id"]&&(e.RequestId=e.headers["x-cos-request-id"]),e.headers["x-cos-version-id"]&&(e.VersionId=e.headers["x-cos-version-id"]),e.headers["x-cos-delete-marker"]&&(e.DeleteMarker=e.headers["x-cos-delete-marker"])),e},u=function(e,t){n&&n.report(e,t),o&&o(c(e),c(t))},l=function(){if("getService"!==e&&"abortUploadTask"!==e){var t=U.call(i,e,r);if(t)return"missing param "+t;if(r.Region){if(i.options.CompatibilityMode){if(!/^([a-z\d-.]+)$/.test(r.Region))return"Region format error."}else{if(r.Region.indexOf("cos.")>-1)return'param Region should not be start with "cos."';if(!/^([a-z\d-]+)$/.test(r.Region))return"Region format error."}!i.options.CompatibilityMode&&-1===r.Region.indexOf("-")&&"yfb"!==r.Region&&"default"!==r.Region&&r.Region}if(r.Bucket){if(!/^([a-z\d-]+)-(\d+)$/.test(r.Bucket))if(r.AppId)r.Bucket=r.Bucket+"-"+r.AppId;else{if(!i.options.AppId)return'Bucket should format as "test-1250000000".';r.Bucket=r.Bucket+"-"+i.options.AppId}r.AppId&&delete r.AppId}!i.options.UseRawKey&&r.Key&&"/"===r.Key.substr(0,1)&&(r.Key=r.Key.substr(1))}}(),d=["getAuth","getObjectUrl"].includes(e);if("function"==typeof Promise&&!d&&!o)return new Promise((function(e,n){if(o=function(t,r){t?n(t):e(r)},l)return u(j.error(new Error(l)));t.call(i,r,u)}));if(l)return u(j.error(new Error(l)));var p=t.call(i,r,u);return d?p:void 0}},xml2json:function(e){var t=d.parse(e);return g(t),t},json2xml:function(e){return p.build(e)},md5:a,clearKey:R,fileSlice:function(e,t,r,o,n){var i;if(e.slice?i=e.slice(t,r):e.mozSlice?i=e.mozSlice(t,r):e.webkitSlice&&(i=e.webkitSlice(t,r)),o&&T){var a=new FileReader;a.onload=function(e){i=null,n(new Blob([a.result]))},a.readAsArrayBuffer(i)}else n(i)},getBodyMd5:function(e,t,r,o){r=r||S,e?"string"==typeof t?r(j.md5(t,!0)):Blob&&t instanceof Blob?j.getFileMd5(t,(function(e,t){r(t)}),o):r():r()},getFileMd5:function(e,t,r){var o=e.size,n=0,i=a.getCtx(),s=function(a){if(a>=o){var c=i.digest("hex");t(null,c)}else{var u=Math.min(o,a+B);j.fileSlice(e,a,u,!1,(function(e){x(e,(function(t){e=null,i=i.update(t,!0),n+=t.length,t=null,r&&r({loaded:n,total:o,percent:Math.round(n/o*1e4)/1e4}),s(a+B)}))}))}};s(0)},b64:function(e){var t,r,o,n="";for(t=0,r=e.length/2;t<r;t++)o=parseInt(e[2*t]+e[2*t+1],16),n+=String.fromCharCode(o);return btoa(n)},extend:E,isArray:P,isInArray:function(e,t){for(var r=!1,o=0;o<e.length;o++)if(t===e[o]){r=!0;break}return r},makeArray:function(e){return P(e)?e:[e]},each:w,map:I,filter:function(e,t){var r=P(e),o=r?[]:{};for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)&&(r?o.push(e[n]):o[n]=e[n]);return o},clone:A,attr:function(e,t,r){return e&&t in e?e[t]:r},uuid:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},camSafeUrlEncode:m,throttleOnProgress:function(e,t){var r,o,n=this,i=0,a=0,s=Date.now();function c(){if(o=0,t&&"function"==typeof t){r=Date.now();var n,c=Math.max(0,Math.round((a-i)/((r-s)/1e3)*100)/100)||0;n=0===a&&0===e?1:Math.floor(a/e*100)/100||0,s=r,i=a;try{t({loaded:a,total:e,speed:c,percent:n})}catch(e){}}}return function(t,r){if(t&&(a=t.loaded,e=t.total),r)clearTimeout(o),c();else{if(o)return;o=setTimeout(c,n.options.ProgressInterval)}}},getFileSize:function(e,t,r){var o;"string"==typeof t.Body?t.Body=new Blob([t.Body],{type:"text/plain"}):t.Body instanceof ArrayBuffer&&(t.Body=new Blob([t.Body])),t.Body&&(t.Body instanceof Blob||"[object File]"===t.Body.toString()||"[object Blob]"===t.Body.toString())?(o=t.Body.size,t.ContentLength=o,r(null,o)):r(j.error(new Error("params body format error, Only allow File|Blob|String.")))},getContentLength:function(e){var t=null,r=e instanceof Blob||"[object File]"===e.toString()||"[object Blob]"===e.toString();if("string"==typeof e)t=new Blob([e],{type:"text/plain"}).size;else if(e instanceof ArrayBuffer){t=new Blob([e]).size}else r&&(t=e.size);return t},getSkewTime:_,error:function(e,t){var r=e;return e.message=e.message||null,"string"==typeof t?(e.error=t,e.message=t):"object"===o(t)&&null!==t&&(E(e,t),(t.code||t.name)&&(e.code=t.code||t.name),t.message&&(e.message=t.message),t.stack&&(e.stack=t.stack)),"function"==typeof Object.defineProperty&&(Object.defineProperty(e,"name",{writable:!0,enumerable:!1}),Object.defineProperty(e,"message",{enumerable:!0})),e.name=t&&t.name||e.name||e.code||"Error",e.code||(e.code=e.name),e.error||(e.error=A(r)),e},obj2str:function(e,t){var r,o,n,i=[],a=y(e);for(r=0;r<a.length;r++)n=void 0===e[o=a[r]]||null===e[o]?"":""+e[o],o=t?m(o).toLowerCase():m(o),n=m(n)||"",i.push(o+"="+n);return i.join("&")},getAuth:function(e){var t,r=(e=e||{}).SecretId,o=e.SecretKey,n=e.KeyTime,i=(e.method||e.Method||"get").toLowerCase(),a=A(e.Query||e.params||{}),c=function(e){var t={};for(var r in e){var o=r.toLowerCase();(o.indexOf("x-cos-")>-1||o.indexOf("x-ci-")>-1||C.indexOf(o)>-1)&&(t[r]=e[r])}return t}(A(e.Headers||e.headers||{})),u=e.Key||"";e.UseRawKey?t=e.Pathname||e.pathname||"/"+u:0!==(t=e.Pathname||e.pathname||u).indexOf("/")&&(t="/"+t);var l=!1!==e.ForceSignHost;if(!c.Host&&!c.host&&e.Bucket&&e.Region&&l&&(c.Host=e.Bucket+".cos."+e.Region+".myqcloud.com"),!r)throw new Error("missing param SecretId");if(!o)throw new Error("missing param SecretKey");var d=Math.round(_(e.SystemClockOffset)/1e3)-1,p=d,f=e.Expires||e.expires;p+=void 0===f?900:1*f||0;var h=r,g=n||d+";"+p,m=n||d+";"+p,k=y(c,!0).join(";").toLowerCase(),v=y(a,!0).join(";").toLowerCase(),b=s.HmacSHA1(m,o).toString(),S=[i,t,j.obj2str(a,!0),j.obj2str(c,!0),""].join("\n"),R=["sha1",g,s.SHA1(S).toString(),""].join("\n");return["q-sign-algorithm=sha1","q-ak="+h,"q-sign-time="+g,"q-key-time="+m,"q-header-list="+k,"q-url-param-list="+v,"q-signature="+s.HmacSHA1(R,b).toString()].join("&")},parseSelectPayload:function(e){for(var t={},r=b(e),o={records:[]};e.byteLength;){var n,i=v(e,32,0),a=v(e,32,4),s=i-a-16,c=0;for(e=e.slice(12);c<a;){var u=v(e,8,c),l=b(e,c+1,c+1+u),d=v(e,16,c+u+2),p=b(e,c+u+4,c+u+4+d);t[l]=p,c+=u+4+d}if("Records"===t[":event-type"])n=b(e,c,c+s,!0),o.records.push(n);else if("Stats"===t[":event-type"])n=b(e,c,c+s,!0),o.stats=j.xml2json(n).Stats;else if("error"===t[":event-type"]){var f=t[":error-code"],h=t[":error-message"],g=new Error(h);g.message=h,g.name=g.code=f,o.error=g}else["Progress","Continuation","End"].includes(t[":event-type"]);e=e.slice(c+s+4)}return{payload:o.records.join(""),body:r}},getSourceParams:function(e){var t=this.options.CopySourceParser;if(t)return t(e);var r=e.match(/^([^.]+-\d+)\.cos(v6|-cdc|-cdz|-internal)?\.([^.]+)\.((myqcloud\.com)|(tencentcos\.cn))\/(.+)$/);return r?{Bucket:r[1],Region:r[3],Key:r[7]}:null},isBrowser:!0,isNode:function(){return"object"!==("undefined"==typeof window?"undefined":o(window))&&"object"===(void 0===t?"undefined":o(t))&&!("object"===("undefined"==typeof globalThis?"undefined":o(globalThis))&&("DedicatedWorkerGlobalScope"===globalThis.constructor.name||globalThis.FileReaderSync))},isCIHost:function(e){return/^https?:\/\/([^/]+\.)?ci\.[^/]+/.test(e)},isIOS_QQ:D&&L,encodeBase64:function(e,t){var r=f.encode(e);return t&&(r=r.replaceAll("+","-").replaceAll("/","_").replaceAll("=","")),r},decodeBase64:function(e){return e?f.decode(e):""},simplifyPath:function(e){var t,r=[],o=n(e.split("/"));try{for(o.s();!(t=o.n()).done;){var i=t.value;".."===i?r.length&&r.pop():i.length&&"."!==i&&r.push(i)}}catch(e){o.e(e)}finally{o.f()}return"/"+r.join("/")},readAsBinaryString:x,parseResBody:function(e){var t;if(e&&"string"==typeof e){var r=e.trim(),o=0===r.indexOf("<"),n=0===r.indexOf("{");if(o)t=j.xml2json(e)||{};else if(n)try{var i=e.replace(/\n/g," "),a=JSON.parse(i);t="[object Object]"===Object.prototype.toString.call(a)?a:e}catch(r){t=e}else t=e}else t=e||{};return t}};e.exports=j}).call(this,r(16))},function(e,t,r){"use strict";const o=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n="["+o+"]["+(o+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*",i=new RegExp("^"+n+"$");t.isExist=function(e){return void 0!==e},t.isEmptyObject=function(e){return 0===Object.keys(e).length},t.merge=function(e,t,r){if(t){const o=Object.keys(t),n=o.length;for(let i=0;i<n;i++)e[o[i]]="strict"===r?[t[o[i]]]:t[o[i]]}},t.getValue=function(e){return t.isExist(e)?e:""},t.isName=function(e){const t=i.exec(e);return!(null==t)},t.getAllMatches=function(e,t){const r=[];let o=t.exec(e);for(;o;){const n=[];n.startIndex=t.lastIndex-o[0].length;const i=o.length;for(let e=0;e<i;e++)n.push(o[e]);r.push(n),o=t.exec(e)}return r},t.nameRegexp=n},function(e){e.exports=JSON.parse('{"name":"cos-js-sdk-v5","version":"1.11.0-beta.2","description":"JavaScript SDK for [腾讯云对象存储](https://cloud.tencent.com/product/cos)","main":"dist/cos-js-sdk-v5.js","types":"index.d.ts","scripts":{"prettier":"prettier --write src demo/demo.js demo/CIDemos/*.js test/test.js server/sts.js lib/request.js index.d.ts","server":"node server/sts.js","dev":"cross-env NODE_ENV=development webpack -w --mode=development","build":"cross-env NODE_ENV=production webpack --mode=production","cos-auth.min.js":"uglifyjs ./demo/common/cos-auth.js -o ./demo/common/cos-auth.min.js -c -m","test":"jest --runInBand --coverage","postinstall":"node scripts/patch-check.js"},"repository":{"type":"git","url":"git+https://github.com/tencentyun/cos-js-sdk-v5.git"},"keywords":[],"author":"carsonxu","license":"ISC","bugs":{"url":"https://github.com/tencentyun/cos-js-sdk-v5/issues"},"homepage":"https://github.com/tencentyun/cos-js-sdk-v5#readme","dependencies":{"fast-xml-parser":"4.5.0"},"devDependencies":{"@babel/core":"7.17.9","@babel/plugin-transform-runtime":"7.18.10","@babel/preset-env":"7.16.11","babel-loader":"8.2.5","body-parser":"^1.18.3","cross-env":"^5.2.0","express":"^4.16.4","jest":"29.7.0","jest-environment-jsdom":"29.7.0","patch-package":"^8.0.0","prettier":"^3.0.1","qcloud-cos-sts":"^3.0.2","request":"^2.87.0","terser-webpack-plugin":"4.2.3","uglifyjs":"^2.4.11","webpack":"4.46.0","webpack-cli":"4.10.0"}}')},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";const o=r(2),n={allowBooleanAttributes:!1,unpairedTags:[]};function i(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function a(e,t){const r=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const o=e.substr(r,t-r);if(t>5&&"xml"===o)return h("InvalidXml","XML declaration allowed only at the start of the document.",m(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function s(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let r=1;for(t+=8;t<e.length;t++)if("<"===e[t])r++;else if(">"===e[t]&&(r--,0===r))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}t.validate=function(e,t){t=Object.assign({},n,t);const r=[];let c=!1,u=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let n=0;n<e.length;n++)if("<"===e[n]&&"?"===e[n+1]){if(n+=2,n=a(e,n),n.err)return n}else{if("<"!==e[n]){if(i(e[n]))continue;return h("InvalidChar","char '"+e[n]+"' is not expected.",m(e,n))}{let g=n;if(n++,"!"===e[n]){n=s(e,n);continue}{let y=!1;"/"===e[n]&&(y=!0,n++);let k="";for(;n<e.length&&">"!==e[n]&&" "!==e[n]&&"\t"!==e[n]&&"\n"!==e[n]&&"\r"!==e[n];n++)k+=e[n];if(k=k.trim(),"/"===k[k.length-1]&&(k=k.substring(0,k.length-1),n--),d=k,!o.isName(d)){let t;return t=0===k.trim().length?"Invalid space after '<'.":"Tag '"+k+"' is an invalid name.",h("InvalidTag",t,m(e,n))}const C=l(e,n);if(!1===C)return h("InvalidAttr","Attributes for '"+k+"' have open quote.",m(e,n));let v=C.value;if(n=C.index,"/"===v[v.length-1]){const r=n-v.length;v=v.substring(0,v.length-1);const o=p(v,t);if(!0!==o)return h(o.err.code,o.err.msg,m(e,r+o.err.line));c=!0}else if(y){if(!C.tagClosed)return h("InvalidTag","Closing tag '"+k+"' doesn't have proper closing.",m(e,n));if(v.trim().length>0)return h("InvalidTag","Closing tag '"+k+"' can't have attributes or invalid starting.",m(e,g));if(0===r.length)return h("InvalidTag","Closing tag '"+k+"' has not been opened.",m(e,g));{const t=r.pop();if(k!==t.tagName){let r=m(e,t.tagStartPos);return h("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+r.line+", col "+r.col+") instead of closing tag '"+k+"'.",m(e,g))}0==r.length&&(u=!0)}}else{const o=p(v,t);if(!0!==o)return h(o.err.code,o.err.msg,m(e,n-v.length+o.err.line));if(!0===u)return h("InvalidXml","Multiple possible root nodes found.",m(e,n));-1!==t.unpairedTags.indexOf(k)||r.push({tagName:k,tagStartPos:g}),c=!0}for(n++;n<e.length;n++)if("<"===e[n]){if("!"===e[n+1]){n++,n=s(e,n);continue}if("?"!==e[n+1])break;if(n=a(e,++n),n.err)return n}else if("&"===e[n]){const t=f(e,n);if(-1==t)return h("InvalidChar","char '&' is not expected.",m(e,n));n=t}else if(!0===u&&!i(e[n]))return h("InvalidXml","Extra text at the end",m(e,n));"<"===e[n]&&n--}}}var d;return c?1==r.length?h("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",m(e,r[0].tagStartPos)):!(r.length>0)||h("InvalidXml","Invalid '"+JSON.stringify(r.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):h("InvalidXml","Start tag expected.",1)};const c='"',u="'";function l(e,t){let r="",o="",n=!1;for(;t<e.length;t++){if(e[t]===c||e[t]===u)""===o?o=e[t]:o!==e[t]||(o="");else if(">"===e[t]&&""===o){n=!0;break}r+=e[t]}return""===o&&{value:r,index:t,tagClosed:n}}const d=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function p(e,t){const r=o.getAllMatches(e,d),n={};for(let e=0;e<r.length;e++){if(0===r[e][1].length)return h("InvalidAttr","Attribute '"+r[e][2]+"' has no space in starting.",y(r[e]));if(void 0!==r[e][3]&&void 0===r[e][4])return h("InvalidAttr","Attribute '"+r[e][2]+"' is without value.",y(r[e]));if(void 0===r[e][3]&&!t.allowBooleanAttributes)return h("InvalidAttr","boolean attribute '"+r[e][2]+"' is not allowed.",y(r[e]));const o=r[e][2];if(!g(o))return h("InvalidAttr","Attribute '"+o+"' is an invalid name.",y(r[e]));if(n.hasOwnProperty(o))return h("InvalidAttr","Attribute '"+o+"' is repeated.",y(r[e]));n[o]=1}return!0}function f(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let r=/\d/;for("x"===e[t]&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(r))break}return-1}(e,++t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(";"===e[t])break;return-1}return t}function h(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function g(e){return o.isName(e)}function m(e,t){const r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function y(e){return e.startIndex+e[1].length}},function(e,t){e.exports=function(e){return"function"==typeof e?e:Array.isArray(e)?t=>{for(const r of e){if("string"==typeof r&&t===r)return!0;if(r instanceof RegExp&&r.test(t))return!0}}:()=>!1}},function(e,t,r){var o=r(8),n=r(9),i=r(0),a=r(3),s=null,c=function(e){return!e||e<0?0:(e/1e3).toFixed(3)},u=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},l=function(){if("object"===("undefined"==typeof navigator?"undefined":i(navigator))){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return(null==e?void 0:e.type)||(null==e?void 0:e.effectiveType)||"unknown"}return"unknown"},d=function(){return"object"===("undefined"==typeof location?"undefined":i(location))?location.protocol.replace(/:/,""):"unknown protocol"},p=function(){if("object"!==("undefined"==typeof navigator?"undefined":i(navigator)))return"unknown os";var e=navigator.userAgent.toLowerCase(),t=/macintosh|mac os x/i.test(navigator.userAgent);return e.indexOf("win32")>=0||e.indexOf("wow32")>=0?"win32":e.indexOf("win64")>=0||e.indexOf("wow64")>=0?"win64":t?"mac":"unknown os"},f=function(){return!("object"!==("undefined"==typeof navigator?"undefined":i(navigator))||!navigator.userAgent.match(/(Android|Adr|Linux)/i))},h=function(){return!("object"!==("undefined"==typeof navigator?"undefined":i(navigator))||!navigator.userAgent.match(/(iPhone|iPod|iPad|iOS)/i))},g=function(){return"object"!==("undefined"==typeof navigator?"undefined":i(navigator))?"unknown device":navigator.userAgent},m=function(){return!("object"!==("undefined"==typeof navigator?"undefined":i(navigator))||!navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))}(),y=f()?"android":h?"ios":"other_mobile",k=p(),C=m?y:k,v=g(),b=d();function S(e){return e.replace(/([A-Z])/g,"_$1").toLowerCase()}var R=function(){"use strict";function e(t){o(this,e);var r=t.parent,n=t.traceId,i=t.bucket,c=t.region,l=t.apiName,d=t.realApi,p=t.httpMethod,f=t.fileKey,h=t.fileSize,g=t.accelerate,m=t.customId,y=t.delay,k=t.deepTracker,S=t.Beacon,R=t.clsReporter,x=i&&i.substr(i.lastIndexOf("-")+1)||"";this.parent=r,this.deepTracker=k,this.delay=y,R&&!this.clsReporter&&(this.clsReporter=R),this.params={sdkVersionName:"cos-js-sdk-v5",sdkVersionCode:a.version,osName:C,networkType:"",requestName:l||"",requestResult:"",realApi:d,bucket:i,region:c,accelerate:g,httpMethod:p,url:"",host:"",httpDomain:"",requestPath:f||"",userAgent:v,networkProtocol:b,errorType:"",errorCode:"",errorName:"",errorMessage:"",errorRequestId:"",errorHttpCode:0,errorServiceName:"",errorNode:"",httpTookTime:0,httpSize:h||0,httpMd5:0,httpSign:0,httpFullTime:0,httpSpeed:0,md5StartTime:0,md5EndTime:0,signStartTime:0,signEndTime:0,httpStartTime:0,httpEndTime:0,startTime:(new Date).getTime(),endTime:0,traceId:n||u(),appid:x,partNumber:0,httpRetryTimes:0,customId:m||"",partTime:0},S&&(this.beacon=function(e,t){if(!s){if("function"!=typeof e)throw new Error("Beacon not found");s=new e({appkey:"0WEB05PY6MHRGK0U",versionCode:a.version,channelID:"js_sdk",openid:"openid",unionid:"unid",strictMode:!1,delay:t,sessionDuration:6e4})}return s}(S,y))}return n(e,[{key:"formatResult",value:function(e,t){var r,o,n,i,a,s,u=(new Date).getTime(),d=l(),p=e?(null==e?void 0:e.code)||(null==e||null===(r=e.error)||void 0===r?void 0:r.code)||(null==e||null===(o=e.error)||void 0===o?void 0:o.Code):"",f=e?(null==e?void 0:e.message)||(null==e||null===(n=e.error)||void 0===n?void 0:n.message)||(null==e||null===(i=e.error)||void 0===i?void 0:i.Message):"",h=f,g=e?(null==e?void 0:e.resource)||(null==e||null===(a=e.error)||void 0===a?void 0:a.resource)||(null==e||null===(s=e.error)||void 0===s?void 0:s.Resource):"",m=e?null==e?void 0:e.statusCode:t.statusCode,y=e?(null==e?void 0:e.headers)&&(null==e?void 0:e.headers["x-cos-request-id"]):(null==t?void 0:t.headers)&&(null==t?void 0:t.headers["x-cos-request-id"]),k=e?y?"Server":"Client":"";"getObject"===this.params.requestName&&(this.params.httpSize=t?t.headers&&t.headers["content-length"]:0);var C="sliceUploadFile"===this.params.realApi,v="sliceCopyFile"===this.params.realApi;if(C||v){var b=this.params.httpSize/1024/this.params.partTime;Object.assign(this.params,{httpSpeed:b<0?0:b.toFixed(3)})}else{var S=u-this.params.startTime,R=this.params.httpEndTime-this.params.httpStartTime,x=this.params.httpSize/1024/(R/1e3),T=this.params.md5EndTime-this.params.md5StartTime,B=this.params.signEndTime-this.params.signStartTime;this.parent&&(this.parent.addParamValue("httpTookTime",c(R)),this.parent.addParamValue("httpFullTime",c(S)),this.parent.addParamValue("httpMd5",c(T)),this.parent.addParamValue("httpSign",c(B)),["multipartUpload","uploadPartCopy","putObjectCopy"].includes(this.params.requestName)&&this.parent.addParamValue("partTime",c(R))),Object.assign(this.params,{httpFullTime:c(S),httpMd5:c(T),httpSign:c(B),httpTookTime:c(R),httpSpeed:x<0?0:x.toFixed(3)})}if(Object.assign(this.params,{networkType:d,requestResult:e?"Failure":"Success",errorType:k,errorCode:p,errorHttpCode:m,errorName:h,errorMessage:f,errorServiceName:g,errorRequestId:y}),!e||p&&f||(this.params.fullError=e?JSON.stringify(e):""),this.params.url){try{var A=/^http(s)?:\/\/(.*?)\//.exec(this.params.url);this.params.host=A[2]}catch(e){this.params.host=this.params.url}this.params.httpDomain=this.params.host}}},{key:"report",value:function(e,t){if(this.beacon||this.clsReporter){this.formatResult(e,t);var r=function(e){var t,r={},o=["sdkVersionName","sdkVersionCode","osName","networkType","requestName","requestResult","bucket","region","appid","accelerate","url","host","requestPath","userAgent","networkProtocol","httpMethod","httpSize","httpSpeed","httpTookTime","httpMd5","httpSign","httpFullTime","httpDomain","partNumber","httpRetryTimes","customId","traceId","realApi"],n=[].concat(o,["errorNode","errorCode","errorName","errorMessage","errorRequestId","errorHttpCode","errorServiceName","errorType","fullError"]),i="Success"===e.requestResult?o:n;for(var a in e)i.includes(a)&&(r[S(a)]=e[a]);return r.request_name=e.realApi?(t=e.realApi,["putObject","sliceUploadFile","uploadFile","uploadFiles"].includes(t)?"UploadTask":"getObject"===t?"DownloadTask":["putObjectCopy","sliceCopyFile"].includes(t)?"CopyTask":t):e.requestName,r}(this.params);this.beacon&&this.sendEventsToBeacon(r),this.clsReporter&&this.sendEventsToCLS(r)}}},{key:"setParams",value:function(e){Object.assign(this.params,e)}},{key:"addParamValue",value:function(e,t){this.params[e]=(+this.params[e]+ +t).toFixed(3)}},{key:"sendEventsToBeacon",value:function(e){if(!("sliceUploadFile"===this.params.requestName||"sliceUploadFile"===this.params.realApi)||this.deepTracker){var t="qcloud_track_cos_sdk";0===this.delay?this.beacon&&this.beacon.onDirectUserAction(t,e):this.beacon&&this.beacon.onUserAction(t,e)}}},{key:"sendEventsToCLS",value:function(e){var t=!(0!==this.delay);this.clsReporter.log(e,t)}},{key:"generateSubTracker",value:function(t){return Object.assign(t,{parent:this,deepTracker:this.deepTracker,traceId:this.params.traceId,bucket:this.params.bucket,region:this.params.region,accelerate:this.params.accelerate,fileKey:this.params.requestPath,customId:this.params.customId,delay:this.delay,clsReporter:this.clsReporter}),new e(t)}}])}();e.exports=R},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var o=r(10);function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var o=r(0).default,n=r(31);e.exports=function(e){var t=n(e,"string");return"symbol"==o(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){var r=function(e){var t={},r=function(e){return!t[e]&&(t[e]=[]),t[e]};e.on=function(e,t){r(e).push(t)},e.off=function(e,t){for(var o=r(e),n=o.length-1;n>=0;n--)t===o[n]&&o.splice(n,1)},e.emit=function(e,t){for(var o=r(e).map((function(e){return e})),n=0;n<o.length;n++)o[n](t)}};e.exports.init=r,e.exports.EventProxy=function(){r(this)}},function(e,t,r){var o,n,i=r(1),a="cos_sdk_upload_cache",s=function(){try{var e=JSON.parse(localStorage.getItem(a))}catch(e){}e||(e=[]),o=e},c=function(){try{o.length?localStorage.setItem(a,JSON.stringify(o)):localStorage.removeItem(a)}catch(e){}},u=function(){if(!o){s.call(this);for(var e=!1,t=Math.round(Date.now()/1e3),r=o.length-1;r>=0;r--){var n=o[r][2];(!n||n+2592e3<t)&&(o.splice(r,1),e=!0)}e&&c()}},l=function(){n||(n=setTimeout((function(){c(),n=null}),400))},d={using:{},setUsing:function(e){d.using[e]=!0},removeUsing:function(e){delete d.using[e]},getFileId:function(e,t,r,o){return e.name&&e.size&&e.lastModifiedDate&&t?i.md5([e.name,e.size,e.lastModifiedDate,t,r,o].join("::")):null},getCopyFileId:function(e,t,r,o,n){var a=t["content-length"],s=t.etag||"",c=t["last-modified"];return e&&r?i.md5([e,a,s,c,r,o,n].join("::")):null},getUploadIdList:function(e){if(!e)return null;u.call(this);for(var t=[],r=0;r<o.length;r++)o[r][0]===e&&t.push(o[r][1]);return t.length?t:null},saveUploadId:function(e,t,r){if(u.call(this),e){for(var n=o.length-1;n>=0;n--){var i=o[n];i[0]===e&&i[1]===t&&o.splice(n,1)}o.unshift([e,t,Math.round(Date.now()/1e3)]),o.length>r&&o.splice(r),l()}},removeUploadId:function(e){u.call(this),delete d.using[e];for(var t=o.length-1;t>=0;t--)o[t][1]===e&&o.splice(t,1);l()}};e.exports=d},function(e,t,r){var o=r(10);e.exports=function(e,t,r){return(t=o(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var o=r(15);e.exports=o},function(e,t,r){"use strict";var o=r(1),n=r(11),i=r(32),a=r(33),s=r(35),c=r(37),u=r(3),l={AppId:"",SecretId:"",SecretKey:"",SecurityToken:"",StartTime:0,ExpiredTime:0,ChunkRetryTimes:2,FileParallelLimit:3,ChunkParallelLimit:3,ChunkSize:1048576,SliceSize:1048576,CopyChunkParallelLimit:20,CopyChunkSize:10485760,CopySliceSize:10485760,MaxPartNumber:1e4,ProgressInterval:1e3,Domain:"",ServiceDomain:"",Protocol:"",CompatibilityMode:!1,ForcePathStyle:!1,UseRawKey:!1,Timeout:0,CorrectClockSkew:!0,SystemClockOffset:0,UploadCheckContentMd5:!1,UploadQueueSize:1e4,UploadAddMetaMd5:!1,UploadIdCacheLimit:50,UseAccelerate:!1,ForceSignHost:!0,AutoSwitchHost:!0,CopySourceParser:null,ObjectKeySimplifyCheck:!0,DeepTracker:!1,TrackerDelay:5e3,CustomId:"",BeaconReporter:null,ClsReporter:null,EnableLog:!1,EnableLogcat:!1,LogLevel:"VERBOSE",ClsLogger:null,LogExtras:{}},d=function(e){var t,r,a=this;if(this.options=o.extend(o.clone(l),e||{}),this.options.FileParallelLimit=Math.max(1,this.options.FileParallelLimit),this.options.ChunkParallelLimit=Math.max(1,this.options.ChunkParallelLimit),this.options.ChunkRetryTimes=Math.max(0,this.options.ChunkRetryTimes),this.options.ChunkSize=Math.max(1048576,this.options.ChunkSize),this.options.CopyChunkParallelLimit=Math.max(1,this.options.CopyChunkParallelLimit),this.options.CopyChunkSize=Math.max(1048576,this.options.CopyChunkSize),this.options.CopySliceSize=Math.max(0,this.options.CopySliceSize),this.options.MaxPartNumber=Math.max(1024,Math.min(1e4,this.options.MaxPartNumber)),this.options.Timeout=Math.max(0,this.options.Timeout),this.options.EnableReporter=this.options.BeaconReporter||this.options.ClsReporter,this.options.AppId,this.options.SecretId&&this.options.SecretId.indexOf(" "),this.options.SecretKey&&this.options.SecretKey.indexOf(" "),o.isNode(),this.options.ForcePathStyle)throw new Error("ForcePathStyle is not supported");n.init(this),i.init(this),this.logger=new c({enableLog:this.options.EnableLog,enableLogcat:this.options.EnableLogcat,level:null!==(t=this.options.LogLevel)&&void 0!==t?t:"VERBOSE",clsLogger:this.options.ClsLogger,logExtras:null!==(r=this.options.LogExtras)&&void 0!==r?r:{}}),this.options.EnableLog&&(n.init(this.logger),this.logger.on("log-message",(function(e){a.emit("log-message",e)})))};a.init(d,i),s.init(d,i),d.util={md5:o.md5,xml2json:o.xml2json,json2xml:o.json2xml,encodeBase64:o.encodeBase64},d.getAuthorization=o.getAuth,d.version=u.version,e.exports=d},function(e,t){var r,o,n=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(e){o=a}}();var c,u=[],l=!1,d=-1;function p(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&f())}function f(){if(!l){var e=s(p);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{return o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new h(e,t)),1!==u.length||l||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t,r){(function(e){var t,o=r(0);!function(){"use strict";var n="object"===("undefined"==typeof window?"undefined":o(window)),i=n?window:{};i.JS_MD5_NO_WINDOW&&(n=!1),!n&&"object"===("undefined"==typeof self?"undefined":o(self))&&(i=self);var a,s=!i.JS_MD5_NO_COMMON_JS&&"object"===o(e)&&e.exports,c=r(18),u=!i.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,l="0123456789abcdef".split(""),d=[128,32768,8388608,-2147483648],p=[0,8,16,24],f=["hex","array","digest","buffer","arrayBuffer","base64"],h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),g=[];if(u){var m=new ArrayBuffer(68);a=new Uint8Array(m),g=new Uint32Array(m)}!i.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!u||!i.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"===o(e)&&e.buffer&&e.buffer.constructor===ArrayBuffer});var y=function(e){return function(t,r){return new k(!0).update(t,r)[e]()}};function k(e){if(e)g[0]=g[16]=g[1]=g[2]=g[3]=g[4]=g[5]=g[6]=g[7]=g[8]=g[9]=g[10]=g[11]=g[12]=g[13]=g[14]=g[15]=0,this.blocks=g,this.buffer8=a;else if(u){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}k.prototype.update=function(e,t){if(!this.finalized){for(var r,o,n=0,i=e.length,a=this.blocks,s=this.buffer8;n<i;){if(this.hashed&&(this.hashed=!1,a[0]=a[16],a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),u)for(o=this.start;n<i&&o<64;++n)r=e.charCodeAt(n),t||r<128?s[o++]=r:r<2048?(s[o++]=192|r>>6,s[o++]=128|63&r):r<55296||r>=57344?(s[o++]=224|r>>12,s[o++]=128|r>>6&63,s[o++]=128|63&r):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++n)),s[o++]=240|r>>18,s[o++]=128|r>>12&63,s[o++]=128|r>>6&63,s[o++]=128|63&r);else for(o=this.start;n<i&&o<64;++n)r=e.charCodeAt(n),t||r<128?a[o>>2]|=r<<p[3&o++]:r<2048?(a[o>>2]|=(192|r>>6)<<p[3&o++],a[o>>2]|=(128|63&r)<<p[3&o++]):r<55296||r>=57344?(a[o>>2]|=(224|r>>12)<<p[3&o++],a[o>>2]|=(128|r>>6&63)<<p[3&o++],a[o>>2]|=(128|63&r)<<p[3&o++]):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++n)),a[o>>2]|=(240|r>>18)<<p[3&o++],a[o>>2]|=(128|r>>12&63)<<p[3&o++],a[o>>2]|=(128|r>>6&63)<<p[3&o++],a[o>>2]|=(128|63&r)<<p[3&o++]);this.lastByteIndex=o,this.bytes+=o-this.start,o>=64?(this.start=o-64,this.hash(),this.hashed=!0):this.start=o}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296|0,this.bytes=this.bytes%4294967296),this}},k.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[t>>2]|=d[3&t],t>=56&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},k.prototype.hash=function(){var e,t,r,o,n,i,a=this.blocks;this.first?t=((t=((e=((e=a[0]-680876937)<<7|e>>>25)-271733879|0)^(r=((r=(-271733879^(o=((o=(-1732584194^2004318071&e)+a[1]-117830708)<<12|o>>>20)+e|0)&(-271733879^e))+a[2]-1126478375)<<17|r>>>15)+o|0)&(o^e))+a[3]-1316259209)<<22|t>>>10)+r|0:(e=this.h0,t=this.h1,r=this.h2,t=((t+=((e=((e+=((o=this.h3)^t&(r^o))+a[0]-680876936)<<7|e>>>25)+t|0)^(r=((r+=(t^(o=((o+=(r^e&(t^r))+a[1]-389564586)<<12|o>>>20)+e|0)&(e^t))+a[2]+606105819)<<17|r>>>15)+o|0)&(o^e))+a[3]-1044525330)<<22|t>>>10)+r|0),t=((t+=((e=((e+=(o^t&(r^o))+a[4]-176418897)<<7|e>>>25)+t|0)^(r=((r+=(t^(o=((o+=(r^e&(t^r))+a[5]+1200080426)<<12|o>>>20)+e|0)&(e^t))+a[6]-1473231341)<<17|r>>>15)+o|0)&(o^e))+a[7]-45705983)<<22|t>>>10)+r|0,t=((t+=((e=((e+=(o^t&(r^o))+a[8]+1770035416)<<7|e>>>25)+t|0)^(r=((r+=(t^(o=((o+=(r^e&(t^r))+a[9]-1958414417)<<12|o>>>20)+e|0)&(e^t))+a[10]-42063)<<17|r>>>15)+o|0)&(o^e))+a[11]-1990404162)<<22|t>>>10)+r|0,t=((t+=((e=((e+=(o^t&(r^o))+a[12]+1804603682)<<7|e>>>25)+t|0)^(r=((r+=(t^(o=((o+=(r^e&(t^r))+a[13]-40341101)<<12|o>>>20)+e|0)&(e^t))+a[14]-1502002290)<<17|r>>>15)+o|0)&(o^e))+a[15]+1236535329)<<22|t>>>10)+r|0,t=((t+=((o=((o+=(t^r&((e=((e+=(r^o&(t^r))+a[1]-165796510)<<5|e>>>27)+t|0)^t))+a[6]-1069501632)<<9|o>>>23)+e|0)^e&((r=((r+=(e^t&(o^e))+a[11]+643717713)<<14|r>>>18)+o|0)^o))+a[0]-373897302)<<20|t>>>12)+r|0,t=((t+=((o=((o+=(t^r&((e=((e+=(r^o&(t^r))+a[5]-701558691)<<5|e>>>27)+t|0)^t))+a[10]+38016083)<<9|o>>>23)+e|0)^e&((r=((r+=(e^t&(o^e))+a[15]-660478335)<<14|r>>>18)+o|0)^o))+a[4]-405537848)<<20|t>>>12)+r|0,t=((t+=((o=((o+=(t^r&((e=((e+=(r^o&(t^r))+a[9]+568446438)<<5|e>>>27)+t|0)^t))+a[14]-1019803690)<<9|o>>>23)+e|0)^e&((r=((r+=(e^t&(o^e))+a[3]-187363961)<<14|r>>>18)+o|0)^o))+a[8]+1163531501)<<20|t>>>12)+r|0,t=((t+=((o=((o+=(t^r&((e=((e+=(r^o&(t^r))+a[13]-1444681467)<<5|e>>>27)+t|0)^t))+a[2]-51403784)<<9|o>>>23)+e|0)^e&((r=((r+=(e^t&(o^e))+a[7]+1735328473)<<14|r>>>18)+o|0)^o))+a[12]-1926607734)<<20|t>>>12)+r|0,t=((t+=((i=(o=((o+=((n=t^r)^(e=((e+=(n^o)+a[5]-378558)<<4|e>>>28)+t|0))+a[8]-2022574463)<<11|o>>>21)+e|0)^e)^(r=((r+=(i^t)+a[11]+1839030562)<<16|r>>>16)+o|0))+a[14]-35309556)<<23|t>>>9)+r|0,t=((t+=((i=(o=((o+=((n=t^r)^(e=((e+=(n^o)+a[1]-1530992060)<<4|e>>>28)+t|0))+a[4]+1272893353)<<11|o>>>21)+e|0)^e)^(r=((r+=(i^t)+a[7]-155497632)<<16|r>>>16)+o|0))+a[10]-1094730640)<<23|t>>>9)+r|0,t=((t+=((i=(o=((o+=((n=t^r)^(e=((e+=(n^o)+a[13]+681279174)<<4|e>>>28)+t|0))+a[0]-358537222)<<11|o>>>21)+e|0)^e)^(r=((r+=(i^t)+a[3]-722521979)<<16|r>>>16)+o|0))+a[6]+76029189)<<23|t>>>9)+r|0,t=((t+=((i=(o=((o+=((n=t^r)^(e=((e+=(n^o)+a[9]-640364487)<<4|e>>>28)+t|0))+a[12]-421815835)<<11|o>>>21)+e|0)^e)^(r=((r+=(i^t)+a[15]+530742520)<<16|r>>>16)+o|0))+a[2]-995338651)<<23|t>>>9)+r|0,t=((t+=((o=((o+=(t^((e=((e+=(r^(t|~o))+a[0]-198630844)<<6|e>>>26)+t|0)|~r))+a[7]+1126891415)<<10|o>>>22)+e|0)^((r=((r+=(e^(o|~t))+a[14]-1416354905)<<15|r>>>17)+o|0)|~e))+a[5]-57434055)<<21|t>>>11)+r|0,t=((t+=((o=((o+=(t^((e=((e+=(r^(t|~o))+a[12]+1700485571)<<6|e>>>26)+t|0)|~r))+a[3]-1894986606)<<10|o>>>22)+e|0)^((r=((r+=(e^(o|~t))+a[10]-1051523)<<15|r>>>17)+o|0)|~e))+a[1]-2054922799)<<21|t>>>11)+r|0,t=((t+=((o=((o+=(t^((e=((e+=(r^(t|~o))+a[8]+1873313359)<<6|e>>>26)+t|0)|~r))+a[15]-30611744)<<10|o>>>22)+e|0)^((r=((r+=(e^(o|~t))+a[6]-1560198380)<<15|r>>>17)+o|0)|~e))+a[13]+1309151649)<<21|t>>>11)+r|0,t=((t+=((o=((o+=(t^((e=((e+=(r^(t|~o))+a[4]-145523070)<<6|e>>>26)+t|0)|~r))+a[11]-1120210379)<<10|o>>>22)+e|0)^((r=((r+=(e^(o|~t))+a[2]+718787259)<<15|r>>>17)+o|0)|~e))+a[9]-343485551)<<21|t>>>11)+r|0,this.first?(this.h0=e+1732584193|0,this.h1=t-271733879|0,this.h2=r-1732584194|0,this.h3=o+271733878|0,this.first=!1):(this.h0=this.h0+e|0,this.h1=this.h1+t|0,this.h2=this.h2+r|0,this.h3=this.h3+o|0)},k.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,o=this.h3;return l[e>>4&15]+l[15&e]+l[e>>12&15]+l[e>>8&15]+l[e>>20&15]+l[e>>16&15]+l[e>>28&15]+l[e>>24&15]+l[t>>4&15]+l[15&t]+l[t>>12&15]+l[t>>8&15]+l[t>>20&15]+l[t>>16&15]+l[t>>28&15]+l[t>>24&15]+l[r>>4&15]+l[15&r]+l[r>>12&15]+l[r>>8&15]+l[r>>20&15]+l[r>>16&15]+l[r>>28&15]+l[r>>24&15]+l[o>>4&15]+l[15&o]+l[o>>12&15]+l[o>>8&15]+l[o>>20&15]+l[o>>16&15]+l[o>>28&15]+l[o>>24&15]},k.prototype.toString=k.prototype.hex,k.prototype.digest=function(e){if("hex"===e)return this.hex();this.finalize();var t=this.h0,r=this.h1,o=this.h2,n=this.h3;return[255&t,t>>8&255,t>>16&255,t>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,255&o,o>>8&255,o>>16&255,o>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255]},k.prototype.array=k.prototype.digest,k.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},k.prototype.buffer=k.prototype.arrayBuffer,k.prototype.base64=function(){for(var e,t,r,o="",n=this.array(),i=0;i<15;)e=n[i++],t=n[i++],r=n[i++],o+=h[e>>>2]+h[63&(e<<4|t>>>4)]+h[63&(t<<2|r>>>6)]+h[63&r];return e=n[i],o+=h[e>>>2]+h[e<<4&63]+"=="};var C=function(){var e=y("hex");e.getCtx=e.create=function(){return new k},e.update=function(t){return e.create().update(t)};for(var t=0;t<f.length;++t){var r=f[t];e[r]=y(r)}return e}();s?e.exports=C:(i.md5=C,c&&(void 0===(t=function(){return C}.call(C,r,C,e))||(e.exports=t)))}()}).call(this,r(4)(e))},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,r){(function(e){var t,o,n,i,a,s,c,u=r(0),l=l||function(e){var t={},r=t.lib={},o=function(){},n=r.Base={extend:function(e){o.prototype=this;var t=new o;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},i=r.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||s).stringify(this)},concat:function(e){var t=this.words,r=e.words,o=this.sigBytes;if(e=e.sigBytes,this.clamp(),o%4)for(var n=0;n<e;n++)t[o+n>>>2]|=(r[n>>>2]>>>24-n%4*8&255)<<24-(o+n)%4*8;else if(65535<r.length)for(n=0;n<e;n+=4)t[o+n>>>2]=r[n>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],o=0;o<t;o+=4)r.push(4294967296*e.random()|0);return new i.init(r,t)}}),a=t.enc={},s=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],o=0;o<e;o++){var n=t[o>>>2]>>>24-o%4*8&255;r.push((n>>>4).toString(16)),r.push((15&n).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],o=0;o<t;o+=2)r[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new i.init(r,t/2)}},c=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],o=0;o<e;o++)r.push(String.fromCharCode(t[o>>>2]>>>24-o%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],o=0;o<t;o++)r[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new i.init(r,t)}},u=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,o=r.words,n=r.sigBytes,a=this.blockSize,s=n/(4*a);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,n=e.min(4*t,n),t){for(var c=0;c<t;c+=a)this._doProcessBlock(o,c);c=o.splice(0,t),r.sigBytes-=n}return new i.init(c,n)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=l.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new d.HMAC.init(e,r).finalize(t)}}});var d=t.algo={};return t}(Math);o=(a=(t=l).lib).WordArray,n=a.Hasher,i=[],a=t.algo.SHA1=n.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,o=r[0],n=r[1],a=r[2],s=r[3],c=r[4],u=0;80>u;u++){if(16>u)i[u]=0|e[t+u];else{var l=i[u-3]^i[u-8]^i[u-14]^i[u-16];i[u]=l<<1|l>>>31}l=(o<<5|o>>>27)+c+i[u],l=20>u?l+(1518500249+(n&a|~n&s)):40>u?l+(1859775393+(n^a^s)):60>u?l+((n&a|n&s|a&s)-1894007588):l+((n^a^s)-899497514),c=s,s=a,a=n<<30|n>>>2,n=o,o=l}r[0]=r[0]+o|0,r[1]=r[1]+n|0,r[2]=r[2]+a|0,r[3]=r[3]+s|0,r[4]=r[4]+c|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(o+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA1=n._createHelper(a),t.HmacSHA1=n._createHmacHelper(a),function(){var e=l,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,r){e=this._hasher=new e.init,"string"==typeof r&&(r=t.parse(r));var o=e.blockSize,n=4*o;r.sigBytes>n&&(r=e.finalize(r)),r.clamp();for(var i=this._oKey=r.clone(),a=this._iKey=r.clone(),s=i.words,c=a.words,u=0;u<o;u++)s[u]^=1549556828,c[u]^=909522486;i.sigBytes=a.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),c=(s=l).lib.WordArray,s.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,o=this._map;e.clamp();for(var n=[],i=0;i<r;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<r;s++)n.push(o.charAt(a>>>6*(3-s)&63));var c=o.charAt(64);if(c)for(;n.length%4;)n.push(c);return n.join("")},parse:function(e){var t=e.length,r=this._map,o=r.charAt(64);if(o){var n=e.indexOf(o);-1!=n&&(t=n)}for(var i=[],a=0,s=0;s<t;s++)if(s%4){var u=r.indexOf(e.charAt(s-1))<<s%4*2,l=r.indexOf(e.charAt(s))>>>6-s%4*2;i[a>>>2]|=(u|l)<<24-a%4*8,a++}return c.create(i,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},"object"===u(e)?e.exports=l:window.CryptoJS=l}).call(this,r(4)(e))},function(e,t,r){"use strict";const o=r(5),n=r(21),i=r(28);e.exports={XMLParser:n,XMLValidator:o,XMLBuilder:i}},function(e,t,r){const{buildOptions:o}=r(22),n=r(23),{prettify:i}=r(27),a=r(5);e.exports=class{constructor(e){this.externalEntities={},this.options=o(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const r=a.validate(e,t);if(!0!==r)throw Error(`${r.err.msg}:${r.err.line}:${r.err.col}`)}const r=new n(this.options);r.addExternalEntities(this.externalEntities);const o=r.parseXml(e);return this.options.preserveOrder||void 0===o?o:i(o,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}}},function(e,t){const r={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,r){return e}};t.buildOptions=function(e){return Object.assign({},r,e)},t.defaultOptions=r},function(e,t,r){"use strict";const o=r(2),n=r(24),i=r(25),a=r(26),s=r(6);function c(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const o=t[r];this.lastEntities[o]={regex:new RegExp("&"+o+";","g"),val:e[o]}}}function u(e,t,r,o,n,i,a){if(void 0!==e&&(this.options.trimValues&&!o&&(e=e.trim()),e.length>0)){a||(e=this.replaceEntitiesValue(e));const o=this.options.tagValueProcessor(t,e,r,n,i);if(null==o)return e;if(typeof o!=typeof e||o!==e)return o;if(this.options.trimValues)return b(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?b(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function l(e){if(this.options.removeNSPrefix){const t=e.split(":"),r="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=r+t[1])}return e}const d=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function p(e,t,r){if(!0!==this.options.ignoreAttributes&&"string"==typeof e){const r=o.getAllMatches(e,d),n=r.length,i={};for(let e=0;e<n;e++){const o=this.resolveNameSpace(r[e][1]);if(this.ignoreAttributesFn(o,t))continue;let n=r[e][4],a=this.options.attributeNamePrefix+o;if(o.length)if(this.options.transformAttributeName&&(a=this.options.transformAttributeName(a)),"__proto__"===a&&(a="#__proto__"),void 0!==n){this.options.trimValues&&(n=n.trim()),n=this.replaceEntitiesValue(n);const e=this.options.attributeValueProcessor(o,n,t);i[a]=null==e?n:typeof e!=typeof n||e!==n?e:b(n,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[a]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=i,e}return i}}const f=function(e){const t=new n("!xml");let r=t,o="",a="";for(let s=0;s<e.length;s++){if("<"===e[s])if("/"===e[s+1]){const t=k(e,">",s,"Closing Tag is not closed.");let n=e.substring(s+2,t).trim();if(this.options.removeNSPrefix){const e=n.indexOf(":");-1!==e&&(n=n.substr(e+1))}this.options.transformTagName&&(n=this.options.transformTagName(n)),r&&(o=this.saveTextToParentTag(o,r,a));const i=a.substring(a.lastIndexOf(".")+1);if(n&&-1!==this.options.unpairedTags.indexOf(n))throw new Error(`Unpaired tag can not be used as closing tag: </${n}>`);let c=0;i&&-1!==this.options.unpairedTags.indexOf(i)?(c=a.lastIndexOf(".",a.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=a.lastIndexOf("."),a=a.substring(0,c),r=this.tagsNodeStack.pop(),o="",s=t}else if("?"===e[s+1]){let t=C(e,s,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(o=this.saveTextToParentTag(o,r,a),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new n(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,a,t.tagName)),this.addChild(r,e,a)}s=t.closeIndex+1}else if("!--"===e.substr(s+1,3)){const t=k(e,"--\x3e",s+4,"Comment is not closed.");if(this.options.commentPropName){const n=e.substring(s+4,t-2);o=this.saveTextToParentTag(o,r,a),r.add(this.options.commentPropName,[{[this.options.textNodeName]:n}])}s=t}else if("!D"===e.substr(s+1,2)){const t=i(e,s);this.docTypeEntities=t.entities,s=t.i}else if("!["===e.substr(s+1,2)){const t=k(e,"]]>",s,"CDATA is not closed.")-2,n=e.substring(s+9,t);o=this.saveTextToParentTag(o,r,a);let i=this.parseTextData(n,r.tagname,a,!0,!1,!0,!0);null==i&&(i=""),this.options.cdataPropName?r.add(this.options.cdataPropName,[{[this.options.textNodeName]:n}]):r.add(this.options.textNodeName,i),s=t+2}else{let i=C(e,s,this.options.removeNSPrefix),c=i.tagName;const u=i.rawTagName;let l=i.tagExp,d=i.attrExpPresent,p=i.closeIndex;this.options.transformTagName&&(c=this.options.transformTagName(c)),r&&o&&"!xml"!==r.tagname&&(o=this.saveTextToParentTag(o,r,a,!1));const f=r;if(f&&-1!==this.options.unpairedTags.indexOf(f.tagname)&&(r=this.tagsNodeStack.pop(),a=a.substring(0,a.lastIndexOf("."))),c!==t.tagname&&(a+=a?"."+c:c),this.isItStopNode(this.options.stopNodes,a,c)){let t="";if(l.length>0&&l.lastIndexOf("/")===l.length-1)"/"===c[c.length-1]?(c=c.substr(0,c.length-1),a=a.substr(0,a.length-1),l=c):l=l.substr(0,l.length-1),s=i.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(c))s=i.closeIndex;else{const r=this.readStopNodeData(e,u,p+1);if(!r)throw new Error(`Unexpected end of ${u}`);s=r.i,t=r.tagContent}const o=new n(c);c!==l&&d&&(o[":@"]=this.buildAttributesMap(l,a,c)),t&&(t=this.parseTextData(t,c,a,!0,d,!0,!0)),a=a.substr(0,a.lastIndexOf(".")),o.add(this.options.textNodeName,t),this.addChild(r,o,a)}else{if(l.length>0&&l.lastIndexOf("/")===l.length-1){"/"===c[c.length-1]?(c=c.substr(0,c.length-1),a=a.substr(0,a.length-1),l=c):l=l.substr(0,l.length-1),this.options.transformTagName&&(c=this.options.transformTagName(c));const e=new n(c);c!==l&&d&&(e[":@"]=this.buildAttributesMap(l,a,c)),this.addChild(r,e,a),a=a.substr(0,a.lastIndexOf("."))}else{const e=new n(c);this.tagsNodeStack.push(r),c!==l&&d&&(e[":@"]=this.buildAttributesMap(l,a,c)),this.addChild(r,e,a),r=e}o="",s=p}}else o+=e[s]}return t.child};function h(e,t,r){const o=this.options.updateTag(t.tagname,r,t[":@"]);!1===o||("string"==typeof o?(t.tagname=o,e.addChild(t)):e.addChild(t))}const g=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){const r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function m(e,t,r,o){return e&&(void 0===o&&(o=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,r,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,o))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function y(e,t,r){const o="*."+r;for(const r in e){const n=e[r];if(o===n||t===n)return!0}return!1}function k(e,t,r,o){const n=e.indexOf(t,r);if(-1===n)throw new Error(o);return n+t.length-1}function C(e,t,r,o=">"){const n=function(e,t,r=">"){let o,n="";for(let i=t;i<e.length;i++){let t=e[i];if(o)t===o&&(o="");else if('"'===t||"'"===t)o=t;else if(t===r[0]){if(!r[1])return{data:n,index:i};if(e[i+1]===r[1])return{data:n,index:i}}else"\t"===t&&(t=" ");n+=t}}(e,t+1,o);if(!n)return;let i=n.data;const a=n.index,s=i.search(/\s/);let c=i,u=!0;-1!==s&&(c=i.substring(0,s),i=i.substring(s+1).trimStart());const l=c;if(r){const e=c.indexOf(":");-1!==e&&(c=c.substr(e+1),u=c!==n.data.substr(e+1))}return{tagName:c,tagExp:i,closeIndex:a,attrExpPresent:u,rawTagName:l}}function v(e,t,r){const o=r;let n=1;for(;r<e.length;r++)if("<"===e[r])if("/"===e[r+1]){const i=k(e,">",r,`${t} is not closed`);if(e.substring(r+2,i).trim()===t&&(n--,0===n))return{tagContent:e.substring(o,r),i:i};r=i}else if("?"===e[r+1]){r=k(e,"?>",r+1,"StopNode is not closed.")}else if("!--"===e.substr(r+1,3)){r=k(e,"--\x3e",r+3,"StopNode is not closed.")}else if("!["===e.substr(r+1,2)){r=k(e,"]]>",r,"StopNode is not closed.")-2}else{const o=C(e,r,">");if(o){(o&&o.tagName)===t&&"/"!==o.tagExp[o.tagExp.length-1]&&n++,r=o.closeIndex}}}function b(e,t,r){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&a(e,r)}return o.isExist(e)?e:""}e.exports=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,16))}},this.addExternalEntities=c,this.parseXml=f,this.parseTextData=u,this.resolveNameSpace=l,this.buildAttributesMap=p,this.isItStopNode=y,this.replaceEntitiesValue=g,this.readStopNodeData=v,this.saveTextToParentTag=m,this.addChild=h,this.ignoreAttributesFn=s(this.options.ignoreAttributes)}}},function(e,t,r){"use strict";e.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},function(e,t,r){const o=r(2);function n(e,t){let r="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)r+=e[t];if(r=r.trim(),-1!==r.indexOf(" "))throw new Error("External entites are not supported");const o=e[t++];let n="";for(;t<e.length&&e[t]!==o;t++)n+=e[t];return[r,n,t]}function i(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function a(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function s(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function c(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function u(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function l(e){if(o.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}e.exports=function(e,t){const r={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let o=1,d=!1,p=!1,f="";for(;t<e.length;t++)if("<"!==e[t]||p)if(">"===e[t]){if(p?"-"===e[t-1]&&"-"===e[t-2]&&(p=!1,o--):o--,0===o)break}else"["===e[t]?d=!0:f+=e[t];else{if(d&&a(e,t))t+=7,[entityName,val,t]=n(e,t+1),-1===val.indexOf("&")&&(r[l(entityName)]={regx:RegExp(`&${entityName};`,"g"),val:val});else if(d&&s(e,t))t+=8;else if(d&&c(e,t))t+=8;else if(d&&u(e,t))t+=9;else{if(!i)throw new Error("Invalid DOCTYPE");p=!0}o++,f=""}if(0!==o)throw new Error("Unclosed DOCTYPE")}return{entities:r,i:t}}},function(e,t){const r=/^[-+]?0x[a-fA-F0-9]+$/,o=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,n={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};e.exports=function(e,t={}){if(t=Object.assign({},n,t),!e||"string"!=typeof e)return e;let i=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(i))return e;if("0"===e)return 0;if(t.hex&&r.test(i))return function(e,t){if(parseInt)return parseInt(e,t);if(Number.parseInt)return Number.parseInt(e,t);if(window&&window.parseInt)return window.parseInt(e,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}(i,16);if(-1!==i.search(/[eE]/)){const r=i.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(r){if(t.leadingZeros)i=(r[1]||"")+r[3];else if("0"!==r[2]||"."!==r[3][0])return e;return t.eNotation?Number(i):e}return e}{const r=o.exec(i);if(r){const o=r[1],n=r[2];let a=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),e;return e}(r[3]);if(!t.leadingZeros&&n.length>0&&o&&"."!==i[2])return e;if(!t.leadingZeros&&n.length>0&&!o&&"."!==i[1])return e;if(t.leadingZeros&&n===e)return 0;{const r=Number(i),s=""+r;return-1!==s.search(/[eE]/)?t.eNotation?r:e:-1!==i.indexOf(".")?"0"===s&&""===a||s===a||o&&s==="-"+a?r:e:n?a===s||o+a===s?r:e:i===s||i===o+s?r:e}}return e}}},function(e,t,r){"use strict";function o(e,t,r){let s;const c={};for(let u=0;u<e.length;u++){const l=e[u],d=n(l);let p="";if(p=void 0===r?d:r+"."+d,d===t.textNodeName)void 0===s?s=l[d]:s+=""+l[d];else{if(void 0===d)continue;if(l[d]){let e=o(l[d],t,p);const r=a(e,t);l[":@"]?i(e,l[":@"],p,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==c[d]&&c.hasOwnProperty(d)?(Array.isArray(c[d])||(c[d]=[c[d]]),c[d].push(e)):t.isArray(d,p,r)?c[d]=[e]:c[d]=e}}}return"string"==typeof s?s.length>0&&(c[t.textNodeName]=s):void 0!==s&&(c[t.textNodeName]=s),c}function n(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const r=t[e];if(":@"!==r)return r}}function i(e,t,r,o){if(t){const n=Object.keys(t),i=n.length;for(let a=0;a<i;a++){const i=n[a];o.isArray(i,r+"."+i,!0,!0)?e[i]=[t[i]]:e[i]=t[i]}}}function a(e,t){const{textNodeName:r}=t,o=Object.keys(e).length;return 0===o||!(1!==o||!e[r]&&"boolean"!=typeof e[r]&&0!==e[r])}t.prettify=function(e,t){return o(e,t)}},function(e,t,r){"use strict";const o=r(29),n=r(6),i={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function a(e){this.options=Object.assign({},i,e),!0===this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=n(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=u),this.processTextOrObjNode=s,this.options.format?(this.indentate=c,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function s(e,t,r,o){const n=this.j2x(e,r+1,o.concat(t));return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,n.attrStr,r):this.buildObjectNode(n.val,t,n.attrStr,r)}function c(e){return this.options.indentBy.repeat(e)}function u(e){return!(!e.startsWith(this.options.attributeNamePrefix)||e===this.options.textNodeName)&&e.substr(this.attrPrefixLen)}a.prototype.build=function(e){return this.options.preserveOrder?o(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0,[]).val)},a.prototype.j2x=function(e,t,r){let o="",n="";const i=r.join(".");for(let a in e)if(Object.prototype.hasOwnProperty.call(e,a))if(void 0===e[a])this.isAttribute(a)&&(n+="");else if(null===e[a])this.isAttribute(a)?n+="":"?"===a[0]?n+=this.indentate(t)+"<"+a+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+a+"/"+this.tagEndChar;else if(e[a]instanceof Date)n+=this.buildTextValNode(e[a],a,"",t);else if("object"!=typeof e[a]){const r=this.isAttribute(a);if(r&&!this.ignoreAttributesFn(r,i))o+=this.buildAttrPairStr(r,""+e[a]);else if(!r)if(a===this.options.textNodeName){let t=this.options.tagValueProcessor(a,""+e[a]);n+=this.replaceEntitiesValue(t)}else n+=this.buildTextValNode(e[a],a,"",t)}else if(Array.isArray(e[a])){const o=e[a].length;let i="",s="";for(let c=0;c<o;c++){const o=e[a][c];if(void 0===o);else if(null===o)"?"===a[0]?n+=this.indentate(t)+"<"+a+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+a+"/"+this.tagEndChar;else if("object"==typeof o)if(this.options.oneListGroup){const e=this.j2x(o,t+1,r.concat(a));i+=e.val,this.options.attributesGroupName&&o.hasOwnProperty(this.options.attributesGroupName)&&(s+=e.attrStr)}else i+=this.processTextOrObjNode(o,a,t,r);else if(this.options.oneListGroup){let e=this.options.tagValueProcessor(a,o);e=this.replaceEntitiesValue(e),i+=e}else i+=this.buildTextValNode(o,a,"",t)}this.options.oneListGroup&&(i=this.buildObjectNode(i,a,s,t)),n+=i}else if(this.options.attributesGroupName&&a===this.options.attributesGroupName){const t=Object.keys(e[a]),r=t.length;for(let n=0;n<r;n++)o+=this.buildAttrPairStr(t[n],""+e[a][t[n]])}else n+=this.processTextOrObjNode(e[a],a,t,r);return{attrStr:o,val:n}},a.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},a.prototype.buildObjectNode=function(e,t,r,o){if(""===e)return"?"===t[0]?this.indentate(o)+"<"+t+r+"?"+this.tagEndChar:this.indentate(o)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let n="</"+t+this.tagEndChar,i="";return"?"===t[0]&&(i="?",n=""),!r&&""!==r||-1!==e.indexOf("<")?!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===i.length?this.indentate(o)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(o)+"<"+t+r+i+this.tagEndChar+e+this.indentate(o)+n:this.indentate(o)+"<"+t+r+i+">"+e+n}},a.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},a.prototype.buildTextValNode=function(e,t,r,o){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(o)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(o)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(o)+"<"+t+r+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(t,e);return n=this.replaceEntitiesValue(n),""===n?this.indentate(o)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(o)+"<"+t+r+">"+n+"</"+t+this.tagEndChar}},a.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e},e.exports=a},function(e,t){function r(e,t,s,c){let u="",l=!1;for(let d=0;d<e.length;d++){const p=e[d],f=o(p);if(void 0===f)continue;let h="";if(h=0===s.length?f:`${s}.${f}`,f===t.textNodeName){let e=p[f];i(h,t)||(e=t.tagValueProcessor(f,e),e=a(e,t)),l&&(u+=c),u+=e,l=!1;continue}if(f===t.cdataPropName){l&&(u+=c),u+=`<![CDATA[${p[f][0][t.textNodeName]}]]>`,l=!1;continue}if(f===t.commentPropName){u+=c+`\x3c!--${p[f][0][t.textNodeName]}--\x3e`,l=!0;continue}if("?"===f[0]){const e=n(p[":@"],t),r="?xml"===f?"":c;let o=p[f][0][t.textNodeName];o=0!==o.length?" "+o:"",u+=r+`<${f}${o}${e}?>`,l=!0;continue}let g=c;""!==g&&(g+=t.indentBy);const m=c+`<${f}${n(p[":@"],t)}`,y=r(p[f],t,h,g);-1!==t.unpairedTags.indexOf(f)?t.suppressUnpairedNode?u+=m+">":u+=m+"/>":y&&0!==y.length||!t.suppressEmptyNode?y&&y.endsWith(">")?u+=m+`>${y}${c}</${f}>`:(u+=m+">",y&&""!==c&&(y.includes("/>")||y.includes("</"))?u+=c+t.indentBy+y+c:u+=y,u+=`</${f}>`):u+=m+"/>",l=!0}return u}function o(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const o=t[r];if(e.hasOwnProperty(o)&&":@"!==o)return o}}function n(e,t){let r="";if(e&&!t.ignoreAttributes)for(let o in e){if(!e.hasOwnProperty(o))continue;let n=t.attributeValueProcessor(o,e[o]);n=a(n,t),!0===n&&t.suppressBooleanAttributes?r+=` ${o.substr(t.attributeNamePrefix.length)}`:r+=` ${o.substr(t.attributeNamePrefix.length)}="${n}"`}return r}function i(e,t){let r=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let o in t.stopNodes)if(t.stopNodes[o]===e||t.stopNodes[o]==="*."+r)return!0;return!1}function a(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){const o=t.entities[r];e=e.replace(o.regex,o.val)}return e}e.exports=function(e,t){let o="";return t.format&&t.indentBy.length>0&&(o="\n"),r(e,t,"",o)}},function(e,t){var r=function(e){var t=(e=e||{}).Base64,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=function(e){for(var t={},r=0,o=e.length;r<o;r++)t[e.charAt(r)]=r;return t}(r),n=String.fromCharCode,i=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?n(192|t>>>6)+n(128|63&t):n(224|t>>>12&15)+n(128|t>>>6&63)+n(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return n(240|t>>>18&7)+n(128|t>>>12&63)+n(128|t>>>6&63)+n(128|63&t)},a=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,s=function(e){return e.replace(a,i)},c=function(e){var t=[0,2,1][e.length%3],o=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[r.charAt(o>>>18),r.charAt(o>>>12&63),t>=2?"=":r.charAt(o>>>6&63),t>=1?"=":r.charAt(63&o)].join("")},u=e.btoa?function(t){return e.btoa(t)}:function(e){return e.replace(/[\s\S]{1,3}/g,c)},l=function(e){return u(s(e))},d=function(e,t){return t?l(String(e)).replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"})).replace(/=/g,""):l(String(e))},p=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),f=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return n(55296+(t>>>10))+n(56320+(1023&t));case 3:return n((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return n((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},h=function(e){return e.replace(p,f)},g=function(e){var t=e.length,r=t%4,i=(t>0?o[e.charAt(0)]<<18:0)|(t>1?o[e.charAt(1)]<<12:0)|(t>2?o[e.charAt(2)]<<6:0)|(t>3?o[e.charAt(3)]:0),a=[n(i>>>16),n(i>>>8&255),n(255&i)];return a.length-=[0,0,2,1][r],a.join("")},m=e.atob?function(t){return e.atob(t)}:function(e){return e.replace(/[\s\S]{1,4}/g,g)},y=function(e){return h(m(e))},k=function(e){return y(String(e).replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,""))};return{VERSION:"2.1.9",atob:m,btoa:u,fromBase64:k,toBase64:d,utob:s,encode:d,encodeURI:function(e){return d(e,!0)},btou:h,decode:k,noConflict:function(){var r=e.Base64;return e.Base64=t,r}}}();e.exports=r},function(e,t,r){var o=r(0).default;e.exports=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var o=r(12),n=r(1),i={};e.exports.transferToTaskMethod=function(e,t){i[t]=e[t],e[t]=function(e,r){e.SkipTask?i[t].call(this,e,r):this._addTask(t,e,r)}},e.exports.init=function(e){var t,r,a=[],s={},c=0,u=0,l=function(e){var t={id:e.id,Bucket:e.Bucket,Region:e.Region,Key:e.Key,FilePath:e.FilePath,state:e.state,loaded:e.loaded,size:e.size,speed:e.speed,percent:e.percent,hashPercent:e.hashPercent,error:e.error};return e.FilePath&&(t.FilePath=e.FilePath),e._custom&&(t._custom=e._custom),t},d=(r=function(){t=0,e.emit("task-list-update",{list:n.map(a,l)}),e.emit("list-update",{list:n.map(a,l)})},function(){t||(t=setTimeout(r))}),p=function(){if(!(a.length<=e.options.UploadQueueSize)){for(var t=0;t<u&&t<a.length&&a.length>e.options.UploadQueueSize;){var r="waiting"===a[t].state||"checking"===a[t].state||"uploading"===a[t].state;a[t]&&r?t++:(s[a[t].id]&&delete s[a[t].id],a.splice(t,1),u--)}d()}},f=function(){if(!(c>=e.options.FileParallelLimit)){for(;a[u]&&"waiting"!==a[u].state;)u++;if(!(u>=a.length)){var t=a[u];u++,c++,t.state="checking",t.params.onTaskStart&&t.params.onTaskStart(l(t)),!t.params.UploadData&&(t.params.UploadData={});var r=n.formatParams(t.api,t.params);i[t.api].call(e,r,(function(r,o){e._isRunningTask(t.id)&&("checking"!==t.state&&"uploading"!==t.state||(t.state=r?"error":"success",r&&(t.error=r),c--,d(),f(),t.callback&&t.callback(r,o),"success"===t.state&&(t.params&&(delete t.params.UploadData,delete t.params.Body,delete t.params),delete t.callback)),p())})),d(),setTimeout(f)}}},h=function(t,r){var n=s[t];if(n){var i=n&&"waiting"===n.state,a=n&&("checking"===n.state||"uploading"===n.state);if("canceled"===r&&"canceled"!==n.state||"paused"===r&&i||"paused"===r&&a){n.state=r,e.emit("inner-kill-task",{TaskId:t,toState:r});try{var u=n&&n.params&&n.params.UploadData.UploadId}catch(e){}"canceled"===r&&u&&o.removeUsing(u),d(),a&&(c--,f()),"canceled"===r&&(n.params&&(delete n.params.UploadData,delete n.params.Body,delete n.params),delete n.callback)}p()}};e._addTasks=function(t){n.each(t,(function(t){e._addTask(t.api,t.params,t.callback,!0)})),d()};e._addTask=function(t,r,o,i){r=n.formatParams(t,r);var c=n.uuid();r.TaskId=c,r.onTaskReady&&r.onTaskReady(c),r.TaskReady&&(r.TaskReady(c),!1);var u={params:r,callback:o,api:t,index:a.length,id:c,Bucket:r.Bucket,Region:r.Region,Key:r.Key,FilePath:r.FilePath||"",state:"waiting",loaded:0,size:0,speed:0,percent:0,hashPercent:0,error:null,_custom:r._custom},l=r.onHashProgress;r.onHashProgress=function(t){e._isRunningTask(u.id)&&(u.hashPercent=t.percent,l&&l(t),d())};var h=r.onProgress;return r.onProgress=function(t){e._isRunningTask(u.id)&&("checking"===u.state&&(u.state="uploading"),u.loaded=t.loaded,u.speed=t.speed,u.percent=t.percent,h&&h(t),d())},n.getFileSize(t,r,(function(e,t){if(e)return o(n.error(e));s[c]=u,a.push(u),u.size=t,!i&&d(),f(),p()})),c},e._isRunningTask=function(e){var t=s[e];return!(!t||"checking"!==t.state&&"uploading"!==t.state)},e.getTaskList=function(){return n.map(a,l)},e.cancelTask=function(e){h(e,"canceled")},e.pauseTask=function(e){h(e,"paused")},e.restartTask=function(e){var t=s[e];!t||"paused"!==t.state&&"error"!==t.state||(t.state="waiting",d(),u=Math.min(u,t.index),f())},e.isUploadRunning=function(){return c||u<a.length}}},function(e,t,r){var o=r(13),n=r(0);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var s=r(34),c=r(1);function u(e,t,r){var o=c.clone(t.InventoryConfiguration);if(o.OptionalFields){var n=o.OptionalFields||[];o.OptionalFields={Field:n}}if(o.Destination&&o.Destination.COSBucketDestination&&o.Destination.COSBucketDestination.Encryption){var i=o.Destination.COSBucketDestination.Encryption;Object.keys(i).indexOf("SSECOS")>-1&&(i["SSE-COS"]=i.SSECOS,delete i.SSECOS)}var a=c.json2xml({InventoryConfiguration:o}),s=t.Headers;s["Content-Type"]="application/xml",s["Content-MD5"]=c.b64(c.md5(a));var u="PUT"===e?"name/cos:PutBucketInventory":"name/cos:PostBucketInventory";y.call(this,{Action:u,method:e,Bucket:t.Bucket,Region:t.Region,body:a,action:"inventory",qs:{id:t.Id},headers:s,tracker:t.tracker},(function(e,t){return e&&204===e.statusCode?r(null,{statusCode:e.statusCode}):e?r(e):void r(null,{statusCode:t.statusCode,headers:t.headers})}))}function l(e){var t={GrantFullControl:[],GrantWrite:[],GrantRead:[],GrantReadAcp:[],GrantWriteAcp:[],ACL:""},r={FULL_CONTROL:"GrantFullControl",WRITE:"GrantWrite",READ:"GrantRead",READ_ACP:"GrantReadAcp",WRITE_ACP:"GrantWriteAcp"},o=(e&&e.AccessControlList||{}).Grant;o&&(o=c.isArray(o)?o:[o]);var n={READ:0,WRITE:0,FULL_CONTROL:0};return o&&o.length&&c.each(o,(function(o){var i=o.Grantee.URI&&o.Grantee.URI.endsWith("/groups/global/AllUsers");"qcs::cam::anyone:anyone"===o.Grantee.ID||i?n[o.Permission]=1:o.Grantee.ID!==e.Owner.ID&&t[r[o.Permission]].push('id="'+o.Grantee.ID+'"')})),n.FULL_CONTROL||n.WRITE&&n.READ?t.ACL="public-read-write":n.READ?t.ACL="public-read":t.ACL="private",c.each(r,(function(e){t[e]=d(t[e].join(","))})),t}function d(e){var t,r,o=e.split(","),n={};for(t=0;t<o.length;)n[r=o[t].trim()]?o.splice(t,1):(n[r]=!0,o[t]=r,t++);return o.join(",")}function p(e){var t=e.region||"",r=e.bucket||"",o=r.substr(0,r.lastIndexOf("-")),i=r.substr(r.lastIndexOf("-")+1),a=e.domain,s=e.object;"function"==typeof a&&(a=a({Bucket:r,Region:t})),["http","https"].includes(e.protocol)&&(e.protocol=e.protocol+":");var u=e.protocol||(c.isBrowser&&"object"===("undefined"==typeof location?"undefined":n(location))&&"http:"===location.protocol?"http:":"https:");a||(a=["cn-south","cn-south-2","cn-north","cn-east","cn-southwest","sg"].indexOf(t)>-1?"{Region}.myqcloud.com":"cos.{Region}.myqcloud.com",e.ForcePathStyle||(a="{Bucket}."+a)),a=(a=a.replace(/\{\{AppId\}\}/gi,i).replace(/\{\{Bucket\}\}/gi,o).replace(/\{\{Region\}\}/gi,t).replace(/\{\{.*?\}\}/gi,"")).replace(/\{AppId\}/gi,i).replace(/\{BucketName\}/gi,o).replace(/\{Bucket\}/gi,r).replace(/\{Region\}/gi,t).replace(/\{.*?\}/gi,""),/^[a-zA-Z]+:\/\//.test(a)||(a=u+"//"+a),"/"===a.slice(-1)&&(a=a.slice(0,-1));var l=a;return e.ForcePathStyle&&(l+="/"+r),l+="/",s&&(l+=c.camSafeUrlEncode(s).replace(/%2F/g,"/")),e.isLocation&&(l=l.replace(/^https?:\/\//,"")),l}var f=function(e){if(!(e.Url||e.Bucket&&e.Region))return"";var t=void 0===e.UseAccelerate?this.options.UseAccelerate:e.UseAccelerate;return(e.Url||p({ForcePathStyle:this.options.ForcePathStyle,protocol:this.options.Protocol,domain:this.options.Domain,bucket:e.Bucket,region:t?"accelerate":e.Region})).replace(/^https?:\/\/([^/]+)(\/.*)?$/,"$1")};function h(e,t){var r=c.clone(e.Headers),o="";c.each(r,(function(e,t){""===e&&delete r[t],"host"===t.toLowerCase()&&(o=e)}));var n=!1!==e.ForceSignHost;!o&&e.SignHost&&n&&(r.Host=e.SignHost);var i=!1,a=function(e,r){i||(i=!0,r&&r.XCosSecurityToken&&!r.SecurityToken&&((r=c.clone(r)).SecurityToken=r.XCosSecurityToken,delete r.XCosSecurityToken),t&&t(e,r))},s=this,u=e.Bucket||"",l=e.Region||"",d=e.Key||"";s.options.ForcePathStyle&&u&&(d=u+"/"+d);var p="/"+d,f={},h=e.Scope;if(!h){var g=e.Action||"",m=e.ResourceKey||e.Key||"";h=e.Scope||[{action:g,bucket:u,region:l,prefix:m}]}var y=c.md5(JSON.stringify(h));s._StsCache=s._StsCache||[],function(){var e,t;for(e=s._StsCache.length-1;e>=0;e--){t=s._StsCache[e];var r=Math.round(c.getSkewTime(s.options.SystemClockOffset)/1e3)+30;if(t.StartTime&&r<t.StartTime||r>=t.ExpiredTime)s._StsCache.splice(e,1);else if(!t.ScopeLimit||t.ScopeLimit&&t.ScopeKey===y){f=t;break}}}();var k=function(){var t="";f.StartTime&&e.Expires?t=f.StartTime+";"+(f.StartTime+1*e.Expires):f.StartTime&&f.ExpiredTime&&(t=f.StartTime+";"+f.ExpiredTime);var o={Authorization:c.getAuth({SecretId:f.TmpSecretId,SecretKey:f.TmpSecretKey,Method:e.Method,Pathname:p,Query:e.Query,Headers:r,Expires:e.Expires,UseRawKey:s.options.UseRawKey,SystemClockOffset:s.options.SystemClockOffset,KeyTime:t,ForceSignHost:n}),SecurityToken:f.SecurityToken||f.XCosSecurityToken||"",Token:f.Token||"",ClientIP:f.ClientIP||"",ClientUA:f.ClientUA||"",SignFrom:"client"};a(null,o)},C=function(e){if(e.Authorization){var t=!1,r=e.Authorization;if(r)if(r.indexOf(" ")>-1)t=!1;else if(r.indexOf("q-sign-algorithm=")>-1&&r.indexOf("q-ak=")>-1&&r.indexOf("q-sign-time=")>-1&&r.indexOf("q-key-time=")>-1&&r.indexOf("q-url-param-list=")>-1)t=!0;else try{(r=atob(r)).indexOf("a=")>-1&&r.indexOf("k=")>-1&&r.indexOf("t=")>-1&&r.indexOf("r=")>-1&&r.indexOf("b=")>-1&&(t=!0)}catch(e){}if(!t)return c.error(new Error("getAuthorization callback params format error"))}else{if(!e.TmpSecretId)return c.error(new Error('getAuthorization callback params missing "TmpSecretId"'));if(!e.TmpSecretKey)return c.error(new Error('getAuthorization callback params missing "TmpSecretKey"'));if(!e.SecurityToken&&!e.XCosSecurityToken)return c.error(new Error('getAuthorization callback params missing "SecurityToken"'));if(!e.ExpiredTime)return c.error(new Error('getAuthorization callback params missing "ExpiredTime"'));if(e.ExpiredTime&&10!==e.ExpiredTime.toString().length)return c.error(new Error('getAuthorization callback params "ExpiredTime" should be 10 digits'));if(e.StartTime&&10!==e.StartTime.toString().length)return c.error(new Error('getAuthorization callback params "StartTime" should be 10 StartTime'))}return!1};if(f.ExpiredTime&&f.ExpiredTime-c.getSkewTime(s.options.SystemClockOffset)/1e3>60)k();else if(s.options.getAuthorization)s.options.getAuthorization.call(s,{Bucket:u,Region:l,Method:e.Method,Key:d,Pathname:p,Query:e.Query,Headers:r,Scope:h,SystemClockOffset:s.options.SystemClockOffset,ForceSignHost:n},(function(e){"string"==typeof e&&(e={Authorization:e});var t=C(e);if(t)return a(t);e.Authorization?a(null,e):((f=e||{}).Scope=h,f.ScopeKey=y,s._StsCache.push(f),k())}));else{if(!s.options.getSTS)return function(){var t="";if(s.options.StartTime&&e.Expires){if(10!==s.options.StartTime.toString().length)return a(c.error(new Error('params "StartTime" should be 10 digits')));t=s.options.StartTime+";"+(s.options.StartTime+1*e.Expires)}else if(s.options.StartTime&&s.options.ExpiredTime){if(10!==s.options.StartTime.toString().length)return a(c.error(new Error('params "StartTime" should be 10 digits')));if(10!==s.options.ExpiredTime.toString().length)return a(c.error(new Error('params "ExpiredTime" should be 10 digits')));t=s.options.StartTime+";"+1*s.options.ExpiredTime}var o={Authorization:c.getAuth({SecretId:e.SecretId||s.options.SecretId,SecretKey:e.SecretKey||s.options.SecretKey,Method:e.Method,Pathname:p,Query:e.Query,Headers:r,Expires:e.Expires,KeyTime:t,UseRawKey:s.options.UseRawKey,SystemClockOffset:s.options.SystemClockOffset,ForceSignHost:n}),SecurityToken:s.options.SecurityToken||s.options.XCosSecurityToken,SignFrom:"client"};return a(null,o),o}();s.options.getSTS.call(s,{Bucket:u,Region:l},(function(e){(f=e||{}).Scope=h,f.ScopeKey=y,f.TmpSecretId||(f.TmpSecretId=f.SecretId),f.TmpSecretKey||(f.TmpSecretKey=f.SecretKey);var t=C(f);if(t)return a(t);s._StsCache.push(f),k()}))}return""}function g(e){var t=!1,r=!1,o=!1,n=e.headers&&(e.headers.date||e.headers.Date)||e.error&&e.error.ServerTime;try{var i=e.error.Code,a=e.error.Message;("RequestTimeTooSkewed"===i||"AccessDenied"===i&&"Request has expired"===a)&&(r=!0)}catch(e){}if(e)if(r&&n){var s=Date.parse(n);this.options.CorrectClockSkew&&Math.abs(c.getSkewTime(this.options.SystemClockOffset)-s)>=3e4&&(this.options.SystemClockOffset=s-Date.now(),t=!0)}else 5===Math.floor(e.statusCode/100)?(t=!0,o=!1):("timeout"===e.message||"CORS blocked or network error"===e.message)&&(t=!0,o=this.options.AutoSwitchHost);return{canRetry:t,networkError:o}}function m(e){var t=e.requestUrl,r=e.clientCalcSign,o=e.networkError;if(!this.options.AutoSwitchHost)return!1;if(!t)return!1;if(!r)return!1;if(!o)return!1;return/^https?:\/\/[^\/]*\.cos\.[^\/]*\.myqcloud\.com(\/.*)?$/.test(t)&&!/^https?:\/\/[^\/]*\.cos\.accelerate\.myqcloud\.com(\/.*)?$/.test(t)}function y(e,t){var r=this;!e.headers&&(e.headers={}),!e.qs&&(e.qs={}),e.VersionId&&(e.qs.versionId=e.VersionId),e.qs=c.clearKey(e.qs),e.headers&&(e.headers=c.clearKey(e.headers)),e.qs&&(e.qs=c.clearKey(e.qs));var o,n=c.clone(e.qs);e.action&&(n[e.action]="");var i=0;c.each(e.headers,(function(e,t){"content-type"===t.toLowerCase()&&(o=e),"content-length"===t.toLowerCase()&&(i=e)}));var s=e.method.toLowerCase(),u=e.body;if(u){if(!i){var l=c.getContentLength(u);if(null===l)return void t(c.error(new Error("params body format error, Only allow File|Blob|String.")));e.headers["Content-Length"]=l}}else["get","head"].includes(s)||(e.headers["Content-Length"]=0);void 0===o&&(e.headers["Content-Type"]="text/plain");var d=e.url||e.Url,p=e.SignHost||f.call(this,{Bucket:e.Bucket,Region:e.Region,Url:d}),y=e.tracker,C=function(o){var i=r.options.SystemClockOffset;y&&y.setParams({signStartTime:(new Date).getTime(),httpRetryTimes:o-1}),e.SwitchHost&&(p=p.replace(/myqcloud.com/,"tencentcos.cn"));var s=a(a({},e),{},{Query:n,SignHost:p,ForceSignHost:r.options.ForceSignHost});delete s.tracker,r.logger.debug({cate:"PROCESS",tag:"base",msg:"开始计算签名, opt=".concat(JSON.stringify(s))}),h.call(r,{Bucket:e.Bucket||"",Region:e.Region||"",Method:e.method,Key:e.Key,Query:n,Headers:e.headers,SignHost:p,Action:e.Action,ResourceKey:e.ResourceKey,Scope:e.Scope,ForceSignHost:r.options.ForceSignHost,SwitchHost:e.SwitchHost},(function(n,a){if(n)return r.logger.error({cate:"PROCESS",tag:"base",msg:"签名获取失败, err=".concat(JSON.stringify(n.message))}),void t(n);y&&y.setParams({signEndTime:(new Date).getTime(),httpStartTime:(new Date).getTime()}),e.AuthData=a,r.logger.debug({cate:"PROCESS",tag:"base",msg:"签名获取成功"}),r.logger.info({cate:"PROCESS",tag:"base",msg:"准备发起请求"}),k.call(r,e,(function(n,s){y&&y.setParams({httpEndTime:(new Date).getTime()});var c=!1,u=!1;if(n){var l=g.call(r,n);c=l.canRetry||i!==r.options.SystemClockOffset,u=l.networkError,r.logger.error({cate:"PROCESS",tag:"network",msg:"请求失败, err=".concat(JSON.stringify(n),", canRetry=").concat(c,", networkError=").concat(u,", tryTimes=").concat(o)})}if(n&&o<4&&c){e.headers&&(delete e.headers.Authorization,delete e.headers.token,delete e.headers.clientIP,delete e.headers.clientUA,e.headers["x-cos-security-token"]&&delete e.headers["x-cos-security-token"],e.headers["x-ci-security-token"]&&delete e.headers["x-ci-security-token"]);var d=m.call(r,{requestUrl:(null==n?void 0:n.url)||"",clientCalcSign:"client"===a.SignFrom,networkError:u});e.SwitchHost=d,e.headers["x-cos-sdk-retry"]=!0,r.logger.info({cate:"PROCESS",tag:"base",msg:"重试请求, 重试第".concat(o,"次")}),C(o+1)}else r.logger.info({cate:"PROCESS",tag:"base",msg:"请求完成"}),t(n,s)}))}))};C(1)}function k(e,t){var r=this,o=e.TaskId;if(!o||r._isRunningTask(o)){var n=e.Bucket,i=e.Region,a=e.Key,u=e.method||"GET",l=e.Url||e.url,d=e.body,f=e.rawBody;r.options.UseAccelerate&&(i="accelerate"),l=l||p({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:n,region:i,object:a}),e.SwitchHost&&(l=l.replace(/myqcloud.com/,"tencentcos.cn"));var h=a?l:"";e.action&&(l=l+"?"+(c.isIOS_QQ?"".concat(e.action,"="):e.action)),e.qsStr&&(l=l.indexOf("?")>-1?l+"&"+e.qsStr:l+"?"+e.qsStr);var g={method:u,url:l,headers:e.headers,qs:e.qs,body:d},m="x-cos-security-token";if(c.isCIHost(l)&&(m="x-ci-security-token"),g.headers.Authorization=e.AuthData.Authorization,e.AuthData.Token&&(g.headers.token=e.AuthData.Token),e.AuthData.ClientIP&&(g.headers.clientIP=e.AuthData.ClientIP),e.AuthData.ClientUA&&(g.headers.clientUA=e.AuthData.ClientUA),e.AuthData.SecurityToken&&(g.headers[m]=e.AuthData.SecurityToken),e.Action&&(g.action=e.Action),g.key=e.Key||e.ResourceKey,g.headers&&(g.headers=c.clearKey(g.headers)),g=c.clearKey(g),e.onProgress&&"function"==typeof e.onProgress){var y=d&&(d.size||d.length)||0;g.onProgress=function(t){if(!o||r._isRunningTask(o)){var n=t?t.loaded:0;e.onProgress({loaded:n,total:y})}}}e.onDownloadProgress&&(g.onDownloadProgress=e.onDownloadProgress),e.DataType&&(g.dataType=e.DataType),this.options.Timeout&&(g.timeout=this.options.Timeout),r.options.ForcePathStyle&&(g.pathStyle=r.options.ForcePathStyle);var k=c.uuid();r.logger.info({cate:"PROCESS",tag:"network",msg:"[Request] ".concat(k,", requestOpt=").concat(JSON.stringify(g))}),r.emit("before-send",g);var C,v=g.url.includes("accelerate."),b=g.qs?Object.keys(g.qs).map((function(e){return"".concat(e,"=").concat(g.qs[e])})).join("&"):"",S=b?g.url+"?"+b:g.url;if(e.tracker)e.tracker.setParams({url:S,httpMethod:g.method,accelerate:v,httpSize:(null===(C=g.body)||void 0===C?void 0:C.size)||0}),e.tracker.parent&&!e.tracker.parent.params.url&&e.tracker.parent.setParams({url:h,accelerate:v});var R=(r.options.Request||s)(g,(function(n){if(!n||"abort"!==n.error){var i={options:g,error:n&&n.error,statusCode:n&&n.statusCode||0,statusMessage:n&&n.statusMessage||"",headers:n&&n.headers||{},body:n&&n.body};r.emit("after-receive",i);var a,s=i.error,u=i.body,l={statusCode:i.statusCode,statusMessage:i.statusMessage,headers:i.headers},d=s?"[error]":"[success]";r.logger.info({cate:"PROCESS",tag:"network",msg:"[Response] ".concat(k,", ").concat(d,", response=").concat(JSON.stringify(l))});var p=function(n,i){if(o&&r.off("inner-kill-task",x),!a){a=!0;var s={};if(l&&l.statusCode&&(s.statusCode=l.statusCode),l&&l.headers&&(s.headers=l.headers),n)g.url&&(s.url=g.url),g.method&&(s.method=g.method),n=c.extend(n||{},s),t(n,null);else{if("name/cos:PutObject"===e.Action){var u={};for(var d in e.headers){u[d.toLowerCase()]=e.headers[d]}u["x-cos-callback"]?i.Error?(i.CallbackError=c.clone(i.Error),delete i.Error):i.CallbackBody=c.clone(i):u["x-cos-return-body"]&&(i.Error?(i.ReturnError=c.clone(i.Error),delete i.Error):i.ReturnBody=c.clone(i))}i=c.extend(i||{},s),t(null,i)}R=null}};if(s)return p(c.error(s));var h=l.statusCode,m=2===Math.floor(h/100);if(f){if(m)return p(null,{body:u});if(u instanceof Blob)return void c.readAsBinaryString(u,(function(e){var t=c.parseResBody(e),r=t.Error||t;return p(c.error(new Error(r.Message||"response body error"),{code:r.Code,error:r}))}))}var y=c.parseResBody(u),C=y.Error||y;m?p(null,y):C?p(c.error(new Error(C.Message),{code:C.Code,error:C})):h?p(c.error(new Error(l.statusMessage),{code:""+h})):h&&p(c.error(new Error("statusCode error")))}})),x=function(e){e.TaskId===o&&(R&&R.abort&&R.abort(),r.off("inner-kill-task",x))};o&&r.on("inner-kill-task",x)}}var C={getService:function(e,t){var r=this.options.Protocol||(c.isBrowser&&"object"===("undefined"==typeof location?"undefined":n(location))&&"http:"===location.protocol?"http:":"https:"),o=this.options.ServiceDomain,i=e.AppId||this.options.appId,a=e.Region;o?(o=o.replace(/\{\{AppId\}\}/gi,i||"").replace(/\{\{Region\}\}/gi,a||"").replace(/\{\{.*?\}\}/gi,""),/^[a-zA-Z]+:\/\//.test(o)||(o=r+"//"+o),"/"===o.slice(-1)&&(o=o.slice(0,-1))):o=a?r+"//cos."+a+".myqcloud.com":r+"//service.cos.myqcloud.com";var s="",u=a?"cos."+a+".myqcloud.com":"service.cos.myqcloud.com";u===o.replace(/^https?:\/\/([^/]+)(\/.*)?$/,"$1")&&(s=u),y.call(this,{Action:"name/cos:GetService",url:o,method:"GET",headers:e.Headers,SignHost:s,tracker:e.tracker},(function(e,r){if(e)return t(e);var o=r&&r.ListAllMyBucketsResult&&r.ListAllMyBucketsResult.Buckets&&r.ListAllMyBucketsResult.Buckets.Bucket||[];o=c.isArray(o)?o:[o];var n=r&&r.ListAllMyBucketsResult&&r.ListAllMyBucketsResult.Owner||{};t(null,{Buckets:o,Owner:n,statusCode:r.statusCode,headers:r.headers})}))},putBucket:function(e,t){var r=this,o="";if(e.BucketAZConfig){var n={BucketAZConfig:e.BucketAZConfig};o=c.json2xml({CreateBucketConfiguration:n})}y.call(this,{Action:"name/cos:PutBucket",method:"PUT",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,body:o,tracker:e.tracker},(function(o,n){if(o)return t(o);var i=p({protocol:r.options.Protocol,domain:r.options.Domain,bucket:e.Bucket,region:e.Region,isLocation:!0});t(null,{Location:i,statusCode:n.statusCode,headers:n.headers})}))},headBucket:function(e,t){y.call(this,{Action:"name/cos:HeadBucket",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,method:"HEAD",tracker:e.tracker},t)},getBucket:function(e,t){var r={};r.prefix=e.Prefix||"",r.delimiter=e.Delimiter,r.marker=e.Marker,r["max-keys"]=e.MaxKeys,r["encoding-type"]=e.EncodingType,y.call(this,{Action:"name/cos:GetBucket",ResourceKey:r.prefix,method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,qs:r,tracker:e.tracker},(function(e,r){if(e)return t(e);var o=r.ListBucketResult||{},n=o.Contents||[],i=o.CommonPrefixes||[];n=c.isArray(n)?n:[n],i=c.isArray(i)?i:[i];var a=c.clone(o);c.extend(a,{Contents:n,CommonPrefixes:i,statusCode:r.statusCode,headers:r.headers}),t(null,a)}))},deleteBucket:function(e,t){y.call(this,{Action:"name/cos:DeleteBucket",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,method:"DELETE",tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},putBucketAcl:function(e,t){var r=e.Headers,o="";if(e.AccessControlPolicy){var n=c.clone(e.AccessControlPolicy||{}),i=n.Grants||n.Grant;i=c.isArray(i)?i:[i],delete n.Grant,delete n.Grants,n.AccessControlList={Grant:i},o=c.json2xml({AccessControlPolicy:n}),r["Content-Type"]="application/xml",r["Content-MD5"]=c.b64(c.md5(o))}c.each(r,(function(e,t){0===t.indexOf("x-cos-grant-")&&(r[t]=d(r[t]))})),y.call(this,{Action:"name/cos:PutBucketACL",method:"PUT",Bucket:e.Bucket,Region:e.Region,headers:r,action:"acl",body:o,tracker:e.tracker},(function(e,r){if(e)return t(e);t(null,{statusCode:r.statusCode,headers:r.headers})}))},getBucketAcl:function(e,t){y.call(this,{Action:"name/cos:GetBucketACL",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"acl",tracker:e.tracker},(function(e,r){if(e)return t(e);var o=r.AccessControlPolicy||{},n=o.Owner||{},i=o.AccessControlList.Grant||[];i=c.isArray(i)?i:[i];var a=l(o);r.headers&&r.headers["x-cos-acl"]&&(a.ACL=r.headers["x-cos-acl"]),a=c.extend(a,{Owner:n,Grants:i,statusCode:r.statusCode,headers:r.headers}),t(null,a)}))},putBucketCors:function(e,t){var r=(e.CORSConfiguration||{}).CORSRules||e.CORSRules||[];r=c.clone(c.isArray(r)?r:[r]),c.each(r,(function(e){c.each(["AllowedOrigin","AllowedHeader","AllowedMethod","ExposeHeader"],(function(t){var r=t+"s",o=e[r]||e[t]||[];delete e[r],e[t]=c.isArray(o)?o:[o]}))}));var o={CORSRule:r};e.ResponseVary&&(o.ResponseVary=e.ResponseVary);var n=c.json2xml({CORSConfiguration:o}),i=e.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=c.b64(c.md5(n)),y.call(this,{Action:"name/cos:PutBucketCORS",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:n,action:"cors",headers:i,tracker:e.tracker},(function(e,r){if(e)return t(e);t(null,{statusCode:r.statusCode,headers:r.headers})}))},getBucketCors:function(e,t){y.call(this,{Action:"name/cos:GetBucketCORS",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"cors",tracker:e.tracker},(function(e,r){if(e)if(404===e.statusCode&&e.error&&"NoSuchCORSConfiguration"===e.error.Code){var o={CORSRules:[],statusCode:e.statusCode};e.headers&&(o.headers=e.headers),t(null,o)}else t(e);else{var n=r.CORSConfiguration||{},i=n.CORSRules||n.CORSRule||[];i=c.clone(c.isArray(i)?i:[i]);var a=n.ResponseVary;c.each(i,(function(e){c.each(["AllowedOrigin","AllowedHeader","AllowedMethod","ExposeHeader"],(function(t){var r=t+"s",o=e[r]||e[t]||[];delete e[t],e[r]=c.isArray(o)?o:[o]}))})),t(null,{CORSRules:i,ResponseVary:a,statusCode:r.statusCode,headers:r.headers})}}))},deleteBucketCors:function(e,t){y.call(this,{Action:"name/cos:DeleteBucketCORS",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"cors",tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode||e.statusCode,headers:r.headers})}))},getBucketLocation:function(e,t){y.call(this,{Action:"name/cos:GetBucketLocation",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"location",tracker:e.tracker},t)},getBucketPolicy:function(e,t){y.call(this,{Action:"name/cos:GetBucketPolicy",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"policy",rawBody:!0,tracker:e.tracker},(function(e,r){if(e)return e.statusCode&&403===e.statusCode?t(c.error(e,{ErrorStatus:"Access Denied"})):e.statusCode&&405===e.statusCode?t(c.error(e,{ErrorStatus:"Method Not Allowed"})):e.statusCode&&404===e.statusCode?t(c.error(e,{ErrorStatus:"Policy Not Found"})):t(e);var o={};try{o=JSON.parse(r.body)}catch(e){}t(null,{Policy:o,statusCode:r.statusCode,headers:r.headers})}))},putBucketPolicy:function(e,t){var r=e.Policy;try{"string"==typeof r&&(r=JSON.parse(r))}catch(e){}if(!r||"string"==typeof r)return t(c.error(new Error("Policy format error")));var o=JSON.stringify(r);r.version||(r.version="2.0");var n=e.Headers;n["Content-Type"]="application/json",n["Content-MD5"]=c.b64(c.md5(o)),y.call(this,{Action:"name/cos:PutBucketPolicy",method:"PUT",Bucket:e.Bucket,Region:e.Region,action:"policy",body:o,headers:n,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},deleteBucketPolicy:function(e,t){y.call(this,{Action:"name/cos:DeleteBucketPolicy",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"policy",tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode||e.statusCode,headers:r.headers})}))},putBucketTagging:function(e,t){var r=e.Tagging||{},o=r.TagSet||r.Tags||e.Tags||[];o=c.clone(c.isArray(o)?o:[o]);var n=c.json2xml({Tagging:{TagSet:{Tag:o}}}),i=e.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=c.b64(c.md5(n)),y.call(this,{Action:"name/cos:PutBucketTagging",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:n,action:"tagging",headers:i,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},getBucketTagging:function(e,t){y.call(this,{Action:"name/cos:GetBucketTagging",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"tagging",tracker:e.tracker},(function(e,r){if(e)if(404!==e.statusCode||!e.error||"Not Found"!==e.error&&"NoSuchTagSet"!==e.error.Code)t(e);else{var o={Tags:[],statusCode:e.statusCode};e.headers&&(o.headers=e.headers),t(null,o)}else{var n=[];try{n=r.Tagging.TagSet.Tag||[]}catch(e){}n=c.clone(c.isArray(n)?n:[n]),t(null,{Tags:n,statusCode:r.statusCode,headers:r.headers})}}))},deleteBucketTagging:function(e,t){y.call(this,{Action:"name/cos:DeleteBucketTagging",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"tagging",tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},putBucketLifecycle:function(e,t){var r=(e.LifecycleConfiguration||{}).Rules||e.Rules||[];r=c.clone(r);var o=c.json2xml({LifecycleConfiguration:{Rule:r}}),n=e.Headers;n["Content-Type"]="application/xml",n["Content-MD5"]=c.b64(c.md5(o)),y.call(this,{Action:"name/cos:PutBucketLifecycle",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:o,action:"lifecycle",headers:n,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},getBucketLifecycle:function(e,t){y.call(this,{Action:"name/cos:GetBucketLifecycle",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"lifecycle",tracker:e.tracker},(function(e,r){if(e)if(404===e.statusCode&&e.error&&"NoSuchLifecycleConfiguration"===e.error.Code){var o={Rules:[],statusCode:e.statusCode};e.headers&&(o.headers=e.headers),t(null,o)}else t(e);else{var n=[];try{n=r.LifecycleConfiguration.Rule||[]}catch(e){}n=c.clone(c.isArray(n)?n:[n]),t(null,{Rules:n,statusCode:r.statusCode,headers:r.headers})}}))},deleteBucketLifecycle:function(e,t){y.call(this,{Action:"name/cos:DeleteBucketLifecycle",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"lifecycle",tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},putBucketVersioning:function(e,t){if(e.VersioningConfiguration){var r=e.VersioningConfiguration||{},o=c.json2xml({VersioningConfiguration:r}),n=e.Headers;n["Content-Type"]="application/xml",n["Content-MD5"]=c.b64(c.md5(o)),y.call(this,{Action:"name/cos:PutBucketVersioning",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:o,action:"versioning",headers:n,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))}else t(c.error(new Error("missing param VersioningConfiguration")))},getBucketVersioning:function(e,t){y.call(this,{Action:"name/cos:GetBucketVersioning",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"versioning",tracker:e.tracker},(function(e,r){e||!r.VersioningConfiguration&&(r.VersioningConfiguration={}),t(e,r)}))},putBucketReplication:function(e,t){var r=c.clone(e.ReplicationConfiguration),o=c.json2xml({ReplicationConfiguration:r});o=(o=o.replace(/<(\/?)Rules>/gi,"<$1Rule>")).replace(/<(\/?)Tags>/gi,"<$1Tag>");var n=e.Headers;n["Content-Type"]="application/xml",n["Content-MD5"]=c.b64(c.md5(o)),y.call(this,{Action:"name/cos:PutBucketReplication",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:o,action:"replication",headers:n,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},getBucketReplication:function(e,t){y.call(this,{Action:"name/cos:GetBucketReplication",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"replication",tracker:e.tracker},(function(e,r){if(e)if(404!==e.statusCode||!e.error||"Not Found"!==e.error&&"ReplicationConfigurationnotFoundError"!==e.error.Code)t(e);else{var o={ReplicationConfiguration:{Rules:[]},statusCode:e.statusCode};e.headers&&(o.headers=e.headers),t(null,o)}else!r.ReplicationConfiguration&&(r.ReplicationConfiguration={}),r.ReplicationConfiguration.Rule&&(r.ReplicationConfiguration.Rules=c.makeArray(r.ReplicationConfiguration.Rule),delete r.ReplicationConfiguration.Rule),t(e,r)}))},deleteBucketReplication:function(e,t){y.call(this,{Action:"name/cos:DeleteBucketReplication",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"replication",tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},putBucketWebsite:function(e,t){if(e.WebsiteConfiguration){var r=c.clone(e.WebsiteConfiguration||{}),o=r.RoutingRules||r.RoutingRule||[];o=c.isArray(o)?o:[o],delete r.RoutingRule,delete r.RoutingRules,o.length&&(r.RoutingRules={RoutingRule:o});var n=c.json2xml({WebsiteConfiguration:r}),i=e.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=c.b64(c.md5(n)),y.call(this,{Action:"name/cos:PutBucketWebsite",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:n,action:"website",headers:i,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))}else t(c.error(new Error("missing param WebsiteConfiguration")))},getBucketWebsite:function(e,t){y.call(this,{Action:"name/cos:GetBucketWebsite",method:"GET",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,action:"website",tracker:e.tracker},(function(e,r){if(e)if(404===e.statusCode&&"NoSuchWebsiteConfiguration"===e.error.Code){var o={WebsiteConfiguration:{},statusCode:e.statusCode};e.headers&&(o.headers=e.headers),t(null,o)}else t(e);else{var n=r.WebsiteConfiguration||{};if(n.RoutingRules){var i=c.clone(n.RoutingRules.RoutingRule||[]);i=c.makeArray(i),n.RoutingRules=i}t(null,{WebsiteConfiguration:n,statusCode:r.statusCode,headers:r.headers})}}))},deleteBucketWebsite:function(e,t){y.call(this,{Action:"name/cos:DeleteBucketWebsite",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"website",tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},putBucketReferer:function(e,t){if(e.RefererConfiguration){var r=c.clone(e.RefererConfiguration||{}),o=r.DomainList||{},n=o.Domains||o.Domain||[];(n=c.isArray(n)?n:[n]).length&&(r.DomainList={Domain:n});var i=c.json2xml({RefererConfiguration:r}),a=e.Headers;a["Content-Type"]="application/xml",a["Content-MD5"]=c.b64(c.md5(i)),y.call(this,{Action:"name/cos:PutBucketReferer",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:i,action:"referer",headers:a,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))}else t(c.error(new Error("missing param RefererConfiguration")))},getBucketReferer:function(e,t){y.call(this,{Action:"name/cos:GetBucketReferer",method:"GET",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,action:"referer",tracker:e.tracker},(function(e,r){if(e)if(404===e.statusCode&&"NoSuchRefererConfiguration"===e.error.Code){var o={WebsiteConfiguration:{},statusCode:e.statusCode};e.headers&&(o.headers=e.headers),t(null,o)}else t(e);else{var n=r.RefererConfiguration||{};if(n.DomainList){var i=c.makeArray(n.DomainList.Domain||[]);n.DomainList={Domains:i}}t(null,{RefererConfiguration:n,statusCode:r.statusCode,headers:r.headers})}}))},putBucketDomain:function(e,t){var r=(e.DomainConfiguration||{}).DomainRule||e.DomainRule||[];r=c.clone(r);var o=c.json2xml({DomainConfiguration:{DomainRule:r}}),n=e.Headers;n["Content-Type"]="application/xml",n["Content-MD5"]=c.b64(c.md5(o)),y.call(this,{Action:"name/cos:PutBucketDomain",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:o,action:"domain",headers:n,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},getBucketDomain:function(e,t){y.call(this,{Action:"name/cos:GetBucketDomain",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"domain",tracker:e.tracker},(function(e,r){if(e)return t(e);var o=[];try{o=r.DomainConfiguration.DomainRule||[]}catch(e){}o=c.clone(c.isArray(o)?o:[o]),t(null,{DomainRule:o,statusCode:r.statusCode,headers:r.headers})}))},deleteBucketDomain:function(e,t){y.call(this,{Action:"name/cos:DeleteBucketDomain",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"domain",tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},putBucketOrigin:function(e,t){var r=(e.OriginConfiguration||{}).OriginRule||e.OriginRule||[];r=c.clone(r);var o=c.json2xml({OriginConfiguration:{OriginRule:r}}),n=e.Headers;n["Content-Type"]="application/xml",n["Content-MD5"]=c.b64(c.md5(o)),y.call(this,{Action:"name/cos:PutBucketOrigin",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:o,action:"origin",headers:n,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},getBucketOrigin:function(e,t){y.call(this,{Action:"name/cos:GetBucketOrigin",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"origin",tracker:e.tracker},(function(e,r){if(e)return t(e);var o=[];try{o=r.OriginConfiguration.OriginRule||[]}catch(e){}o=c.clone(c.isArray(o)?o:[o]),t(null,{OriginRule:o,statusCode:r.statusCode,headers:r.headers})}))},deleteBucketOrigin:function(e,t){y.call(this,{Action:"name/cos:DeleteBucketOrigin",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"origin",tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},putBucketLogging:function(e,t){var r=c.json2xml({BucketLoggingStatus:e.BucketLoggingStatus||""}),o=e.Headers;o["Content-Type"]="application/xml",o["Content-MD5"]=c.b64(c.md5(r)),y.call(this,{Action:"name/cos:PutBucketLogging",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:r,action:"logging",headers:o,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},getBucketLogging:function(e,t){y.call(this,{Action:"name/cos:GetBucketLogging",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"logging",tracker:e.tracker},(function(e,r){if(e)return t(e);t(null,{BucketLoggingStatus:r.BucketLoggingStatus,statusCode:r.statusCode,headers:r.headers})}))},putBucketInventory:function(e,t){return u.call(this,"PUT",e,t)},postBucketInventory:function(e,t){return u.call(this,"POST",e,t)},getBucketInventory:function(e,t){y.call(this,{Action:"name/cos:GetBucketInventory",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"inventory",qs:{id:e.Id},tracker:e.tracker},(function(e,r){if(e)return t(e);var o=r.InventoryConfiguration;if(o&&o.OptionalFields&&o.OptionalFields.Field){var n=o.OptionalFields.Field;c.isArray(n)||(n=[n]),o.OptionalFields=n}if(o.Destination&&o.Destination.COSBucketDestination&&o.Destination.COSBucketDestination.Encryption){var i=o.Destination.COSBucketDestination.Encryption;Object.keys(i).indexOf("SSE-COS")>-1&&(i.SSECOS=i["SSE-COS"],delete i["SSE-COS"])}t(null,{InventoryConfiguration:o,statusCode:r.statusCode,headers:r.headers})}))},listBucketInventory:function(e,t){y.call(this,{Action:"name/cos:ListBucketInventory",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"inventory",qs:{"continuation-token":e.ContinuationToken},tracker:e.tracker},(function(e,r){if(e)return t(e);var o=r.ListInventoryConfigurationResult,n=o.InventoryConfiguration||[];n=c.isArray(n)?n:[n],delete o.InventoryConfiguration,c.each(n,(function(e){if(e&&e.OptionalFields&&e.OptionalFields.Field){var t=e.OptionalFields.Field;c.isArray(t)||(t=[t]),e.OptionalFields=t}if(e.Destination&&e.Destination.COSBucketDestination&&e.Destination.COSBucketDestination.Encryption){var r=e.Destination.COSBucketDestination.Encryption;Object.keys(r).indexOf("SSE-COS")>-1&&(r.SSECOS=r["SSE-COS"],delete r["SSE-COS"])}})),o.InventoryConfigurations=n,c.extend(o,{statusCode:r.statusCode,headers:r.headers}),t(null,o)}))},deleteBucketInventory:function(e,t){y.call(this,{Action:"name/cos:DeleteBucketInventory",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"inventory",qs:{id:e.Id},tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},putBucketAccelerate:function(e,t){if(e.AccelerateConfiguration){var r={AccelerateConfiguration:e.AccelerateConfiguration||{}},o=c.json2xml(r),n={"Content-Type":"application/xml"};n["Content-MD5"]=c.b64(c.md5(o)),y.call(this,{Action:"name/cos:PutBucketAccelerate",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:o,action:"accelerate",headers:n,tracker:e.tracker},(function(e,r){if(e)return t(e);t(null,{statusCode:r.statusCode,headers:r.headers})}))}else t(c.error(new Error("missing param AccelerateConfiguration")))},getBucketAccelerate:function(e,t){y.call(this,{Action:"name/cos:GetBucketAccelerate",method:"GET",Bucket:e.Bucket,Region:e.Region,action:"accelerate",tracker:e.tracker},(function(e,r){e||!r.AccelerateConfiguration&&(r.AccelerateConfiguration={}),t(e,r)}))},putBucketEncryption:function(e,t){var r=e.ServerSideEncryptionConfiguration||{},o=r.Rule||r.Rules||[],n=c.json2xml({ServerSideEncryptionConfiguration:{Rule:o}}),i=e.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=c.b64(c.md5(n)),y.call(this,{Action:"name/cos:PutBucketEncryption",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:n,action:"encryption",headers:i,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},getBucketEncryption:function(e,t){y.call(this,{Action:"name/cos:GetBucketEncryption",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"encryption",tracker:e.tracker},(function(e,r){if(e)if(404===e.statusCode&&"NoSuchEncryptionConfiguration"===e.code){var o={EncryptionConfiguration:{Rules:[]},statusCode:e.statusCode};e.headers&&(o.headers=e.headers),t(null,o)}else t(e);else{var n=c.makeArray(r.EncryptionConfiguration&&r.EncryptionConfiguration.Rule||[]);r.EncryptionConfiguration={Rules:n},t(e,r)}}))},deleteBucketEncryption:function(e,t){y.call(this,{Action:"name/cos:DeleteBucketReplication",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"encryption",tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},getObject:function(e,t){var r=this;if(r.logger.info({cate:"PROCESS",tag:"download",msg:"[key=".concat(e.Key,"] getObject开始")}),this.options.ObjectKeySimplifyCheck&&"/"===c.simplifyPath(e.Key))return void t(c.error(new Error("The Getobject Key is illegal")));var o=e.Query||{},n=e.QueryString||"",i=c.throttleOnProgress.call(this,0,e.onProgress),a=e.tracker;a&&a.setParams({signStartTime:(new Date).getTime()}),o["response-content-type"]=e.ResponseContentType,o["response-content-language"]=e.ResponseContentLanguage,o["response-expires"]=e.ResponseExpires,o["response-cache-control"]=e.ResponseCacheControl,o["response-content-disposition"]=e.ResponseContentDisposition,o["response-content-encoding"]=e.ResponseContentEncoding,y.call(this,{Action:"name/cos:GetObject",method:"GET",Bucket:e.Bucket,Region:e.Region,Key:e.Key,VersionId:e.VersionId,DataType:e.DataType,headers:e.Headers,qs:o,qsStr:n,rawBody:!0,onDownloadProgress:i,tracker:a},(function(o,n){if(i(null,!0),o){var a=o.statusCode;return e.Headers["If-Modified-Since"]&&a&&304===a?t(null,{NotModified:!0}):t(o)}t(null,{Body:n.body,ETag:c.attr(n.headers,"etag",""),statusCode:n.statusCode,headers:n.headers}),r.logger.info({cate:"PROCESS",tag:"download",msg:"[key=".concat(e.Key,"] getObject结束")})}))},headObject:function(e,t){y.call(this,{Action:"name/cos:HeadObject",method:"HEAD",Bucket:e.Bucket,Region:e.Region,Key:e.Key,VersionId:e.VersionId,headers:e.Headers,tracker:e.tracker},(function(r,o){if(r){var n=r.statusCode;return e.Headers["If-Modified-Since"]&&n&&304===n?t(null,{NotModified:!0,statusCode:n}):t(r)}o.ETag=c.attr(o.headers,"etag",""),t(null,o)}))},listObjectVersions:function(e,t){var r={};r.prefix=e.Prefix||"",r.delimiter=e.Delimiter,r["key-marker"]=e.KeyMarker,r["version-id-marker"]=e.VersionIdMarker,r["max-keys"]=e.MaxKeys,r["encoding-type"]=e.EncodingType,y.call(this,{Action:"name/cos:GetBucketObjectVersions",ResourceKey:r.prefix,method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,qs:r,action:"versions",tracker:e.tracker},(function(e,r){if(e)return t(e);var o=r.ListVersionsResult||{},n=o.DeleteMarker||[];n=c.isArray(n)?n:[n];var i=o.Version||[];i=c.isArray(i)?i:[i];var a=c.clone(o);delete a.DeleteMarker,delete a.Version,c.extend(a,{DeleteMarkers:n,Versions:i,statusCode:r.statusCode,headers:r.headers}),t(null,a)}))},putObject:function(e,t){var r=this,o=e.ContentLength,n=c.throttleOnProgress.call(r,o,e.onProgress);r.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] putObject开始")});var i=e.Headers;i["Cache-Control"]||i["cache-control"]||(i["Cache-Control"]=""),i["Content-Type"]||i["content-type"]||(i["Content-Type"]=e.Body&&e.Body.type||"");var a=e.UploadAddMetaMd5||r.options.UploadAddMetaMd5||r.options.UploadCheckContentMd5,s=e.tracker;a&&s&&s.setParams({md5StartTime:(new Date).getTime()}),a&&r.logger.debug({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 开始计算 md5")}),c.getBodyMd5(a,e.Body,(function(a){a&&(r.logger.debug({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] md5: ").concat(a,"，md5Base64=").concat(c.b64(a))}),s&&s.setParams({md5EndTime:(new Date).getTime()}),r.options.UploadCheckContentMd5&&(i["Content-MD5"]=c.b64(a)),(e.UploadAddMetaMd5||r.options.UploadAddMetaMd5)&&(i["x-cos-meta-md5"]=a)),void 0!==e.ContentLength&&(i["Content-Length"]=e.ContentLength),n(null,!0),y.call(r,{Action:"name/cos:PutObject",TaskId:e.TaskId,method:"PUT",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,qs:e.Query,body:e.Body,onProgress:n,tracker:s},(function(i,a){if(i)return r.logger.error({cate:"ERROR",tag:"upload",msg:"上传失败，错误信息：".concat(JSON.stringify(i))}),n(null,!0),t(i);n({loaded:o,total:o},!0);var s=p({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:e.Bucket,region:r.options.UseAccelerate?"accelerate":e.Region,object:e.Key});s=s.substr(s.indexOf("://")+3),a.Location=s,a.ETag=c.attr(a.headers,"etag",""),r.logger.info({cate:"RESULT",tag:"upload",msg:"上传成功，Location=".concat(s)}),r.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] putObject结束")}),t(null,a)}))}),e.onHashProgress)},deleteObject:function(e,t){y.call(this,{Action:"name/cos:DeleteObject",method:"DELETE",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,VersionId:e.VersionId,action:e.Recursive?"recursive":"",tracker:e.tracker},(function(e,r){if(e){var o=e.statusCode;return o&&404===o?t(null,{BucketNotFound:!0,statusCode:o}):t(e)}t(null,{statusCode:r.statusCode,headers:r.headers})}))},getObjectAcl:function(e,t){var r={};e.VersionId&&(r.versionId=e.VersionId),y.call(this,{Action:"name/cos:GetObjectACL",method:"GET",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,qs:r,action:"acl",tracker:e.tracker},(function(e,r){if(e)return t(e);var o=r.AccessControlPolicy||{},n=o.Owner||{},i=o.AccessControlList&&o.AccessControlList.Grant||[];i=c.isArray(i)?i:[i];var a=l(o);delete a.GrantWrite,r.headers&&r.headers["x-cos-acl"]&&(a.ACL=r.headers["x-cos-acl"]),a=c.extend(a,{Owner:n,Grants:i,statusCode:r.statusCode,headers:r.headers}),t(null,a)}))},putObjectAcl:function(e,t){var r=e.Headers,o="";if(e.AccessControlPolicy){var n=c.clone(e.AccessControlPolicy||{}),i=n.Grants||n.Grant;i=c.isArray(i)?i:[i],delete n.Grant,delete n.Grants,n.AccessControlList={Grant:i},o=c.json2xml({AccessControlPolicy:n}),r["Content-Type"]="application/xml",r["Content-MD5"]=c.b64(c.md5(o))}c.each(r,(function(e,t){0===t.indexOf("x-cos-grant-")&&(r[t]=d(r[t]))})),y.call(this,{Action:"name/cos:PutObjectACL",method:"PUT",Bucket:e.Bucket,Region:e.Region,Key:e.Key,action:"acl",headers:r,body:o,tracker:e.tracker},(function(e,r){if(e)return t(e);t(null,{statusCode:r.statusCode,headers:r.headers})}))},optionsObject:function(e,t){var r=e.Headers;r.Origin=e.Origin,r["Access-Control-Request-Method"]=e.AccessControlRequestMethod,r["Access-Control-Request-Headers"]=e.AccessControlRequestHeaders,y.call(this,{Action:"name/cos:OptionsObject",method:"OPTIONS",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:r,tracker:e.tracker},(function(e,r){if(e)return e.statusCode&&403===e.statusCode?t(null,{OptionsForbidden:!0,statusCode:e.statusCode}):t(e);var o=r.headers||{};t(null,{AccessControlAllowOrigin:o["access-control-allow-origin"],AccessControlAllowMethods:o["access-control-allow-methods"],AccessControlAllowHeaders:o["access-control-allow-headers"],AccessControlExposeHeaders:o["access-control-expose-headers"],AccessControlMaxAge:o["access-control-max-age"],statusCode:r.statusCode,headers:r.headers})}))},putObjectCopy:function(e,t){var r=this,o=e.Headers;o["Cache-Control"]||o["cache-control"]||(o["Cache-Control"]="");var n=e.CopySource||"",i=c.getSourceParams.call(this,n);if(i){var a=i.Bucket,s=i.Region,u=decodeURIComponent(i.Key);y.call(this,{Scope:[{action:"name/cos:GetObject",bucket:a,region:s,prefix:u},{action:"name/cos:PutObject",bucket:e.Bucket,region:e.Region,prefix:e.Key}],method:"PUT",Bucket:e.Bucket,Region:e.Region,Key:e.Key,VersionId:e.VersionId,headers:e.Headers,tracker:e.tracker},(function(o,n){if(o)return t(o);var i=c.clone(n.CopyObjectResult||{}),a=p({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:e.Bucket,region:e.Region,object:e.Key,isLocation:!0});c.extend(i,{Location:a,statusCode:n.statusCode,headers:n.headers}),t(null,i)}))}else t(c.error(new Error("CopySource format error")))},deleteMultipleObject:function(e,t){var r=e.Objects||[],o=e.Quiet;r=c.isArray(r)?r:[r];var n=c.json2xml({Delete:{Object:r,Quiet:o||!1}}),i=e.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=c.b64(c.md5(n));var a=c.map(r,(function(t){return{action:"name/cos:DeleteObject",bucket:e.Bucket,region:e.Region,prefix:t.Key}}));y.call(this,{Scope:a,method:"POST",Bucket:e.Bucket,Region:e.Region,body:n,action:"delete",headers:i,tracker:e.tracker},(function(e,r){if(e)return t(e);var o=r.DeleteResult||{},n=o.Deleted||[],i=o.Error||[];n=c.isArray(n)?n:[n],i=c.isArray(i)?i:[i];var a=c.clone(o);c.extend(a,{Error:i,Deleted:n,statusCode:r.statusCode,headers:r.headers}),t(null,a)}))},restoreObject:function(e,t){var r=e.Headers;if(e.RestoreRequest){var o=e.RestoreRequest||{},n=c.json2xml({RestoreRequest:o});r["Content-Type"]="application/xml",r["Content-MD5"]=c.b64(c.md5(n)),y.call(this,{Action:"name/cos:RestoreObject",method:"POST",Bucket:e.Bucket,Region:e.Region,Key:e.Key,VersionId:e.VersionId,body:n,action:"restore",headers:r,tracker:e.tracker},t)}else t(c.error(new Error("missing param RestoreRequest")))},putObjectTagging:function(e,t){var r=e.Tagging||{},o=r.TagSet||r.Tags||e.Tags||[];o=c.clone(c.isArray(o)?o:[o]);var n=c.json2xml({Tagging:{TagSet:{Tag:o}}}),i=e.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=c.b64(c.md5(n)),y.call(this,{Action:"name/cos:PutObjectTagging",method:"PUT",Bucket:e.Bucket,Key:e.Key,Region:e.Region,body:n,action:"tagging",headers:i,VersionId:e.VersionId,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},getObjectTagging:function(e,t){y.call(this,{Action:"name/cos:GetObjectTagging",method:"GET",Key:e.Key,Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"tagging",VersionId:e.VersionId,tracker:e.tracker},(function(e,r){if(e)if(404!==e.statusCode||!e.error||"Not Found"!==e.error&&"NoSuchTagSet"!==e.error.Code)t(e);else{var o={Tags:[],statusCode:e.statusCode};e.headers&&(o.headers=e.headers),t(null,o)}else{var n=[];try{n=r.Tagging.TagSet.Tag||[]}catch(e){}n=c.clone(c.isArray(n)?n:[n]),t(null,{Tags:n,statusCode:r.statusCode,headers:r.headers})}}))},deleteObjectTagging:function(e,t){y.call(this,{Action:"name/cos:DeleteObjectTagging",method:"DELETE",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,action:"tagging",VersionId:e.VersionId,tracker:e.tracker},(function(e,r){return e&&204===e.statusCode?t(null,{statusCode:e.statusCode}):e?t(e):void t(null,{statusCode:r.statusCode,headers:r.headers})}))},selectObjectContent:function(e,t){if(!e.SelectType)return t(c.error(new Error("missing param SelectType")));var r=e.SelectRequest||{},o=c.json2xml({SelectRequest:r}),n=e.Headers;n["Content-Type"]="application/xml",n["Content-MD5"]=c.b64(c.md5(o)),y.call(this,{Action:"name/cos:GetObject",method:"POST",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,action:"select",qs:{"select-type":e.SelectType},VersionId:e.VersionId,body:o,DataType:"arraybuffer",rawBody:!0,tracker:e.tracker},(function(e,r){if(e&&204===e.statusCode)return t(null,{statusCode:e.statusCode});if(e)return t(e);var o=c.parseSelectPayload(r.body);t(null,{statusCode:r.statusCode,headers:r.headers,Body:o.body,Payload:o.payload})}))},appendObject:function(e,t){var r=e.Headers;r["Cache-Control"]||r["cache-control"]||(r["Cache-Control"]=""),r["Content-Type"]||r["content-type"]||(r["Content-Type"]=e.Body&&e.Body.type||""),y.call(this,{Action:"name/cos:AppendObject",method:"POST",Bucket:e.Bucket,Region:e.Region,action:"append",Key:e.Key,body:e.Body,qs:{position:e.Position},headers:e.Headers,tracker:e.tracker},(function(e,r){if(e)return t(e);t(null,r)}))},uploadPartCopy:function(e,t){var r=e.CopySource||"",o=c.getSourceParams.call(this,r);if(o){var n=o.Bucket,i=o.Region,a=decodeURIComponent(o.Key);y.call(this,{Scope:[{action:"name/cos:GetObject",bucket:n,region:i,prefix:a},{action:"name/cos:PutObject",bucket:e.Bucket,region:e.Region,prefix:e.Key}],method:"PUT",Bucket:e.Bucket,Region:e.Region,Key:e.Key,VersionId:e.VersionId,qs:{partNumber:e.PartNumber,uploadId:e.UploadId},headers:e.Headers,tracker:e.tracker},(function(e,r){if(e)return t(e);var o=c.clone(r.CopyPartResult||{});c.extend(o,{statusCode:r.statusCode,headers:r.headers}),t(null,o)}))}else t(c.error(new Error("CopySource format error")))},multipartInit:function(e,t){var r=this,o=e.Headers,n=e.tracker;o["Cache-Control"]||o["cache-control"]||(o["Cache-Control"]=""),o["Content-Type"]||o["content-type"]||(o["Content-Type"]=e.Body&&e.Body.type||"");var i=e.Body&&(e.UploadAddMetaMd5||r.options.UploadAddMetaMd5);i&&n&&n.setParams({md5StartTime:(new Date).getTime()}),c.getBodyMd5(i,e.Body,(function(o){o&&(e.Headers["x-cos-meta-md5"]=o),i&&n&&n.setParams({md5EndTime:(new Date).getTime()}),y.call(r,{Action:"name/cos:InitiateMultipartUpload",method:"POST",Bucket:e.Bucket,Region:e.Region,Key:e.Key,action:"uploads",headers:e.Headers,qs:e.Query,tracker:n},(function(e,r){return e?(n&&n.parent&&n.parent.setParams({errorNode:"multipartInit"}),t(e)):(r=c.clone(r||{}))&&r.InitiateMultipartUploadResult?t(null,c.extend(r.InitiateMultipartUploadResult,{statusCode:r.statusCode,headers:r.headers})):void t(null,r)}))}),e.onHashProgress)},multipartUpload:function(e,t){var r=this;c.getFileSize("multipartUpload",e,(function(){var o=e.tracker,n=r.options.UploadCheckContentMd5;n&&o&&o.setParams({md5StartTime:(new Date).getTime()}),c.getBodyMd5(n,e.Body,(function(i){i&&(e.Headers["Content-MD5"]=c.b64(i)),n&&o&&o.setParams({md5EndTime:(new Date).getTime()}),o&&o.setParams({partNumber:e.PartNumber}),y.call(r,{Action:"name/cos:UploadPart",TaskId:e.TaskId,method:"PUT",Bucket:e.Bucket,Region:e.Region,Key:e.Key,qs:{partNumber:e.PartNumber,uploadId:e.UploadId},headers:e.Headers,onProgress:e.onProgress,body:e.Body||null,tracker:o},(function(e,r){if(e)return o&&o.parent&&o.parent.setParams({errorNode:"multipartUpload"}),t(e);t(null,{ETag:c.attr(r.headers,"etag",""),statusCode:r.statusCode,headers:r.headers})}))}))}))},multipartComplete:function(e,t){for(var r=this,o=e.UploadId,n=e.Parts,i=e.tracker,a=0,s=n.length;a<s;a++)n[a].ETag&&0===n[a].ETag.indexOf('"')||(n[a].ETag='"'+n[a].ETag+'"');var u=c.json2xml({CompleteMultipartUpload:{Part:n}});u=u.replace(/\n\s*/g,"");var l=e.Headers;l["Content-Type"]="application/xml",l["Content-MD5"]=c.b64(c.md5(u)),y.call(this,{Action:"name/cos:CompleteMultipartUpload",method:"POST",Bucket:e.Bucket,Region:e.Region,Key:e.Key,qs:{uploadId:o},body:u,headers:l,tracker:i},(function(o,n){if(o)return i&&i.parent&&i.parent.setParams({errorNode:"multipartComplete"}),t(o);var a=p({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:e.Bucket,region:r.options.UseAccelerate?"accelerate":e.Region,object:e.Key,isLocation:!0}),s=n.CompleteMultipartUploadResult||{};if(s.ProcessResults&&(s.UploadResult={OriginalInfo:{Key:s.Key,Location:a,ETag:s.ETag,ImageInfo:s.ImageInfo},ProcessResults:s.ProcessResults},delete s.ImageInfo,delete s.ProcessResults),s.CallbackResult){var u=s.CallbackResult;if("200"===u.Status&&u.CallbackBody)try{s.CallbackBody=JSON.parse(c.decodeBase64(u.CallbackBody))}catch(e){s.CallbackBody={}}else s.CallbackError=u.Error||{};delete s.CallbackResult}if(s.ReturnBodyResult){var l=s.ReturnBodyResult;if("200"===l.Status&&l.ReturnBody)try{s.ReturnBody=JSON.parse(c.decodeBase64(l.ReturnBody))}catch(e){s.ReturnBody={}}else s.ReturnError={Code:l.Code,Message:l.Message,Status:l.Status};delete s.ReturnBodyResult}var d=c.extend(s,{Location:a,statusCode:n.statusCode,headers:n.headers});t(null,d)}))},multipartList:function(e,t){var r={};r.delimiter=e.Delimiter,r["encoding-type"]=e.EncodingType,r.prefix=e.Prefix||"",r["max-uploads"]=e.MaxUploads,r["key-marker"]=e.KeyMarker,r["upload-id-marker"]=e.UploadIdMarker,r=c.clearKey(r);var o=e.tracker;o&&o.setParams({signStartTime:(new Date).getTime()}),y.call(this,{Action:"name/cos:ListMultipartUploads",ResourceKey:r.prefix,method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,qs:r,action:"uploads",tracker:o},(function(e,r){if(e)return o&&o.parent&&o.parent.setParams({errorNode:"multipartList"}),t(e);if(r&&r.ListMultipartUploadsResult){var n=r.ListMultipartUploadsResult.Upload||[];n=c.isArray(n)?n:[n],r.ListMultipartUploadsResult.Upload=n}var i=c.clone(r.ListMultipartUploadsResult||{});c.extend(i,{statusCode:r.statusCode,headers:r.headers}),t(null,i)}))},multipartListPart:function(e,t){var r={},o=e.tracker;r.uploadId=e.UploadId,r["encoding-type"]=e.EncodingType,r["max-parts"]=e.MaxParts,r["part-number-marker"]=e.PartNumberMarker,y.call(this,{Action:"name/cos:ListParts",method:"GET",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,qs:r,tracker:o},(function(e,r){if(e)return o&&o.parent&&o.parent.setParams({errorNode:"multipartListPart"}),t(e);var n=r.ListPartsResult||{},i=n.Part||[];i=c.isArray(i)?i:[i],n.Part=i;var a=c.clone(n);c.extend(a,{statusCode:r.statusCode,headers:r.headers}),t(null,a)}))},multipartAbort:function(e,t){var r={};r.uploadId=e.UploadId,y.call(this,{Action:"name/cos:AbortMultipartUpload",method:"DELETE",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,qs:r,tracker:e.tracker},(function(e,r){if(e)return t(e);t(null,{statusCode:r.statusCode,headers:r.headers})}))},request:function(e,t){y.call(this,{method:e.Method,Bucket:e.Bucket,Region:e.Region,Key:e.Key,action:e.Action,headers:e.Headers,qs:e.Query,body:e.Body,Url:e.Url,rawBody:e.RawBody,DataType:e.DataType,tracker:e.tracker},(function(e,r){if(e)return t(e);r&&r.body&&(r.Body=r.body,delete r.body),t(e,r)}))},getObjectUrl:function(e,t){var r=this,o=void 0===e.UseAccelerate?r.options.UseAccelerate:e.UseAccelerate,n=p({ForcePathStyle:r.options.ForcePathStyle,protocol:e.Protocol||r.options.Protocol,domain:e.Domain||r.options.Domain,bucket:e.Bucket,region:o?"accelerate":e.Region,object:e.Key}),i="";e.Query&&(i+=c.obj2str(e.Query)),e.QueryString&&(i+=(i?"&":"")+e.QueryString);var a=n;if(void 0!==e.Sign&&!e.Sign)return i&&(a+="?"+i),t(null,{Url:a}),a;var s=f.call(this,{Bucket:e.Bucket,Region:e.Region,UseAccelerate:e.UseAccelerate,Url:n}),u=h.call(this,{Action:"PUT"===(e.Method||"").toUpperCase()?"name/cos:PutObject":"name/cos:GetObject",Bucket:e.Bucket||"",Region:e.Region||"",Method:e.Method||"get",Key:e.Key,Expires:e.Expires,Headers:e.Headers,Query:e.Query,SignHost:s,ForceSignHost:!1!==e.ForceSignHost&&r.options.ForceSignHost},(function(e,r){if(t)if(e)t(e);else{var o=n;o+="?"+(r.Authorization.indexOf("q-signature")>-1?function(e){var t=e.match(/q-url-param-list.*?(?=&)/g)[0],r="q-url-param-list="+encodeURIComponent(t.replace(/q-url-param-list=/,"")).toLowerCase(),o=new RegExp(t,"g");return e.replace(o,r)}(r.Authorization):"sign="+encodeURIComponent(r.Authorization)),r.SecurityToken&&(o+="&x-cos-security-token="+r.SecurityToken),r.ClientIP&&(o+="&clientIP="+r.ClientIP),r.ClientUA&&(o+="&clientUA="+r.ClientUA),r.Token&&(o+="&token="+r.Token),i&&(o+="&"+i),setTimeout((function(){t(null,{Url:o})}))}}));return u?(a+="?"+u.Authorization+(u.SecurityToken?"&x-cos-security-token="+u.SecurityToken:""),i&&(a+="&"+i)):i&&(a+="?"+i),a},getAuth:function(e){return c.getAuth({SecretId:e.SecretId||this.options.SecretId||"",SecretKey:e.SecretKey||this.options.SecretKey||"",Bucket:e.Bucket,Region:e.Region,Method:e.Method,Key:e.Key,Query:e.Query,Headers:e.Headers,Expires:e.Expires,UseRawKey:this.options.UseRawKey,SystemClockOffset:this.options.SystemClockOffset})}};e.exports.init=function(e,t){t.transferToTaskMethod(C,"putObject"),c.each(C,(function(t,r){e.prototype[r]=c.apiWrapper(r,t),function(e,t,r){c.each(["Cors","Acl"],(function(o){if(e.slice(-o.length)===o){var n=e.slice(0,-o.length)+o.toUpperCase(),i=c.apiWrapper(e,t);r[n]=function(){i.apply(this,arguments)}}}))}(r,t,e.prototype)}))}},function(e,t,r){var o=r(0),n=function(e){switch(o(e)){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},i=function(e,t,r){var o={},n=t.getAllResponseHeaders();return n&&n.length>0&&n.trim().split("\n").forEach((function(e){if(e){var t=e.indexOf(":"),r=e.substr(0,t).trim().toLowerCase(),n=e.substr(t+1).trim();o[r]=n}})),{error:e,statusCode:t.status,statusMessage:t.statusText,headers:o,body:r}},a=function(e,t){return t||"text"!==t?e.response:e.responseText};e.exports=function(e,t){var r,s,c,u,l=(e.method||"GET").toUpperCase(),d=e.url;if(e.qs){var p=(r=e.qs,s=s||"&",c=c||"=",null===r&&(r=void 0),"object"===o(r)?Object.keys(r).map((function(e){var t=encodeURIComponent(n(e))+c;return Array.isArray(r[e])?r[e].map((function(e){return t+encodeURIComponent(n(e))})).join(s):t+encodeURIComponent(n(r[e]))})).filter(Boolean).join(s):u?encodeURIComponent(n(u))+c+encodeURIComponent(n(r)):"");p&&(d+=(-1===d.indexOf("?")?"?":"&")+p)}var f=new XMLHttpRequest;if(f.open(l,d,!0),f.responseType=e.dataType||"text",e.xhrFields)for(var h in e.xhrFields)f[h]=e.xhrFields[h];var g=e.headers;if(g)for(var m in g)g.hasOwnProperty(m)&&"content-length"!==m.toLowerCase()&&"user-agent"!==m.toLowerCase()&&"origin"!==m.toLowerCase()&&"host"!==m.toLowerCase()&&f.setRequestHeader(m,g[m]);return e.onProgress&&f.upload&&(f.upload.onprogress=e.onProgress),e.onDownloadProgress&&(f.onprogress=e.onDownloadProgress),e.timeout&&(f.timeout=e.timeout),f.ontimeout=function(e){var r=new Error("timeout");t(i(r,f))},f.onload=function(){t(i(null,f,a(f,e.dataType)))},f.onerror=function(r){var o=a(f,e.dataType);if(o)t(i(null,f,o));else{var n=f.statusText;n||0!==f.status||(n=new Error("CORS blocked or network error")),t(i(n,f,o))}},f.send(e.body||""),f}},function(e,t,r){var o=r(0),n=r(12),i=r(36),a=r(11).EventProxy,s=r(1),c=r(7);function u(e,t){var r=e.TaskId,o=e.Bucket,c=e.Region,u=e.Key,p=e.StorageClass,f=this,h={},g=e.FileSize,m=e.SliceSize,y=Math.ceil(g/m),k=0,C=s.throttleOnProgress.call(f,g,e.onHashProgress),v=function(t,r){var o=t.length;if(0===o)return r(null,!0);if(o>y)return r(null,!1);if(o>1&&Math.max(t[0].Size,t[1].Size)!==m)return r(null,!1);var n=function(i){if(i<o){var a=t[i];!function(t,r){var o=m*(t-1),n=Math.min(o+m,g),i=n-o;h[t]?r(null,{PartNumber:t,ETag:h[t],Size:i}):s.fileSlice(e.Body,o,n,!1,(function(e){s.getFileMd5(e,(function(e,o){if(e)return r(s.error(e));var n='"'+o+'"';h[t]=n,C({loaded:k+=i,total:g}),r(null,{PartNumber:t,ETag:n,Size:i})}))}))}(a.PartNumber,(function(e,t){t&&t.ETag===a.ETag&&t.Size===a.Size?n(i+1):r(null,!1)}))}else r(null,!0)};n(0)},b=new a;b.on("error",(function(e){if(f._isRunningTask(r))return t(e)})),b.on("upload_id_available",(function(e){var r={},o=[];s.each(e.PartList,(function(e){r[e.PartNumber]=e}));for(var n=1;n<=y;n++){var i=r[n];i?(i.PartNumber=n,i.Uploaded=!0):i={PartNumber:n,ETag:null,Uploaded:!1},o.push(i)}e.PartList=o,t(null,e)})),b.on("no_available_upload_id",(function(){if(f._isRunningTask(r)){var n=s.extend({Bucket:o,Region:c,Key:u,Query:s.clone(e.Query),StorageClass:p,Body:e.Body,calledBySdk:"sliceUploadFile",tracker:e.tracker},e),i=s.clone(e.Headers);delete i["x-cos-mime-limit"],n.Headers=i,f.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 准备初始化分块上传")}),f.multipartInit(n,(function(o,n){if(f._isRunningTask(r)){if(o)return f.logger.error({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 初始化分块上传失败, ").concat(JSON.stringify(o))}),b.emit("error",o);var i=n.UploadId;if(!i)return t(s.error(new Error("no such upload id")));f.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 初始化分块上传成功")}),b.emit("upload_id_available",{UploadId:i,PartList:[]})}}))}})),b.on("has_and_check_upload_id",(function(t){t=t.reverse(),i.eachLimit(t,1,(function(t,i){f._isRunningTask(r)&&(n.using[t]?i():d.call(f,{Bucket:o,Region:c,Key:u,UploadId:t,tracker:e.tracker},(function(e,o){if(f._isRunningTask(r)){if(e)return n.removeUsing(t),b.emit("error",e);var a=o.PartList;a.forEach((function(e){e.PartNumber*=1,e.Size*=1,e.ETag=e.ETag||""})),v(a,(function(e,o){if(f._isRunningTask(r))return e?b.emit("error",e):void(o?i({UploadId:t,PartList:a}):i())}))}})))}),(function(e){f._isRunningTask(r)&&(C(null,!0),e&&e.UploadId?b.emit("upload_id_available",e):b.emit("no_available_upload_id"))}))})),b.on("seek_local_avail_upload_id",(function(t){var i=n.getFileId(e.Body,e.ChunkSize,o,u),a=n.getUploadIdList.call(f,i);if(i&&a){var l=function(i){if(i>=a.length)b.emit("has_and_check_upload_id",t);else{var p=a[i];if(!s.isInArray(t,p))return n.removeUploadId.call(f,p),void l(i+1);n.using[p]?l(i+1):d.call(f,{Bucket:o,Region:c,Key:u,UploadId:p,tracker:e.tracker},(function(e,t){f._isRunningTask(r)&&(e?(n.removeUploadId.call(f,p),l(i+1)):b.emit("upload_id_available",{UploadId:p,PartList:t.PartList}))}))}};l(0)}else b.emit("has_and_check_upload_id",t)})),b.on("get_remote_upload_id_list",(function(){l.call(f,{Bucket:o,Region:c,Key:u,tracker:e.tracker},(function(t,i){if(f._isRunningTask(r)){if(t)return b.emit("error",t);var a=s.filter(i.UploadList,(function(e){return e.Key===u&&(!p||e.StorageClass.toUpperCase()===p.toUpperCase())})).reverse().map((function(e){return e.UploadId||e.UploadID}));if(a.length)b.emit("seek_local_avail_upload_id",a);else{var c,l=n.getFileId(e.Body,e.ChunkSize,o,u);l&&(c=n.getUploadIdList.call(f,l))&&s.each(c,(function(e){n.removeUploadId.call(f,e)})),b.emit("no_available_upload_id")}}}))})),b.emit("get_remote_upload_id_list")}function l(e,t){var r=this,o=[],n={Bucket:e.Bucket,Region:e.Region,Prefix:e.Key,calledBySdk:e.calledBySdk||"sliceUploadFile",tracker:e.tracker},i=function(){r.multipartList(n,(function(e,r){if(e)return t(e);o.push.apply(o,r.Upload||[]),"true"===r.IsTruncated?(n.KeyMarker=r.NextKeyMarker,n.UploadIdMarker=r.NextUploadIdMarker,i()):t(null,{UploadList:o})}))};i()}function d(e,t){var r=this,o=[],n={Bucket:e.Bucket,Region:e.Region,Key:e.Key,UploadId:e.UploadId,calledBySdk:"sliceUploadFile",tracker:e.tracker},i=function(){r.multipartListPart(n,(function(e,r){if(e)return t(e);o.push.apply(o,r.Part||[]),"true"===r.IsTruncated?(n.PartNumberMarker=r.NextPartNumberMarker,i()):t(null,{PartList:o})}))};i()}function p(e,t){var r=this,o=e.TaskId,n=e.Bucket,a=e.Region,c=e.Key,u=e.UploadData,l=e.FileSize,d=e.SliceSize,p=Math.min(e.AsyncLimit||r.options.ChunkParallelLimit||1,256),h=e.Body,g=Math.ceil(l/d),m=0,y=e.ServerSideEncryption,k=e.Headers,C=s.filter(u.PartList,(function(e){return e.Uploaded&&(m+=e.PartNumber>=g&&l%d||d),!e.Uploaded})),v=e.onProgress;r.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 开始并发上传各个分块")}),i.eachLimit(C,p,(function(t,i){if(r._isRunningTask(o)){var s=t.PartNumber,p=Math.min(l,t.PartNumber*d)-(t.PartNumber-1)*d,g=0;r.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 分块").concat(s,"开始上传")}),f.call(r,{TaskId:o,Bucket:n,Region:a,Key:c,SliceSize:d,FileSize:l,PartNumber:s,ServerSideEncryption:y,Body:h,UploadData:u,Headers:k,onProgress:function(e){m+=e.loaded-g,g=e.loaded,v({loaded:m,total:l})},tracker:e.tracker},(function(n,a){r._isRunningTask(o)&&(n||a.ETag||(n='get ETag error, please add "ETag" to CORS ExposeHeader setting.( 获取ETag失败，请在CORS ExposeHeader设置中添加ETag，请参考文档：https://cloud.tencent.com/document/product/436/13318 )',r.logger.error({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 分块").concat(s,"上传请求成功，但是未获取到 eTag")})),n?(m-=g,r.logger.info({cate:"RESULT",tag:"upload",msg:"[key=".concat(e.Key,"] 分块").concat(s,"上传失败")})):(m+=p-g,t.ETag=a.ETag),r.logger.info({cate:"RESULT",tag:"upload",msg:"[key=".concat(e.Key,"] 分块").concat(s,"上传成功")}),v({loaded:m,total:l}),i(n||null,a))}))}}),(function(e){if(r._isRunningTask(o))return e?t(e):void t(null,{UploadId:u.UploadId,SliceList:u.PartList})}))}function f(e,t){var r=this,o=e.TaskId,n=e.Bucket,a=e.Region,c=e.Key,u=e.FileSize,l=e.Body,d=1*e.PartNumber,p=e.SliceSize,f=e.ServerSideEncryption,h=e.UploadData,g=e.Headers||{},m=r.options.ChunkRetryTimes+1,y=p*(d-1),k=p,C=y+p;C>u&&(k=(C=u)-y);var v=["x-cos-traffic-limit","x-cos-mime-limit"],b={};s.each(g,(function(e,t){v.indexOf(t)>-1&&(b[t]=e)}));var S=h.PartList[d-1];i.retry(m,(function(t){r._isRunningTask(o)&&s.fileSlice(l,y,C,!0,(function(i){r.multipartUpload({TaskId:o,Bucket:n,Region:a,Key:c,ContentLength:k,PartNumber:d,UploadId:h.UploadId,ServerSideEncryption:f,Body:i,Headers:b,onProgress:e.onProgress,calledBySdk:"sliceUploadFile",tracker:e.tracker},(function(e,n){if(r._isRunningTask(o))return e?t(e):(S.Uploaded=!0,t(null,n))}))}))}),(function(e,n){if(r._isRunningTask(o))return t(e,n)}))}function h(e,t){var r=e.Bucket,o=e.Region,n=e.Key,a=e.UploadId,s=e.SliceList,c=this,u=this.options.ChunkRetryTimes+1,l=e.Headers,d=s.map((function(e){return{PartNumber:e.PartNumber,ETag:e.ETag}}));i.retry(u,(function(t){c.multipartComplete({Bucket:r,Region:o,Key:n,UploadId:a,Parts:d,Headers:l,calledBySdk:"sliceUploadFile",tracker:e.tracker},t)}),(function(e,r){t(e,r)}))}function g(e,t){var r=e.Bucket,o=e.Region,n=e.Key,a=e.AbortArray,s=e.AsyncLimit||1,c=this,u=0,l=new Array(a.length);i.eachLimit(a,s,(function(t,i){var a=u;if(n&&n!==t.Key)return l[a]={error:{KeyNotMatch:!0}},void i(null);var s=t.UploadId||t.UploadID;c.multipartAbort({Bucket:r,Region:o,Key:t.Key,Headers:e.Headers,UploadId:s},(function(e){var n={Bucket:r,Region:o,Key:t.Key,UploadId:s};l[a]={error:e,task:n},i(null)})),u++}),(function(e){if(e)return t(e);for(var r=[],o=[],n=0,i=l.length;n<i;n++){var a=l[n];a.task&&(a.error?o.push(a.task):r.push(a.task))}return t(null,{successList:r,errorList:o})}))}function m(e,t){var r=e.TaskId,o=e.Bucket,n=e.Region,a=e.Key,s=e.CopySource,c=e.UploadId,u=1*e.PartNumber,l=e.CopySourceRange,d=this.options.ChunkRetryTimes+1,p=this;i.retry(d,(function(t){p.uploadPartCopy({TaskId:r,Bucket:o,Region:n,Key:a,CopySource:s,UploadId:c,PartNumber:u,CopySourceRange:l,tracker:e.tracker,calledBySdk:e.calledBySdk},(function(e,r){t(e||null,r)}))}),(function(e,r){return t(e,r)}))}var y={sliceUploadFile:function(e,t){var r,o,i=this,c=new a,l=e.TaskId,d=e.Bucket,f=e.Region,g=e.Key,m=e.Body,y=e.ChunkSize||e.SliceSize||i.options.ChunkSize,k=e.AsyncLimit,C=e.StorageClass,v=e.ServerSideEncryption,b=e.onHashProgress,S=e.tracker;S&&S.setParams({chunkSize:y}),i.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 分块上传开始")}),c.on("error",(function(r){if(i._isRunningTask(l))return e.UploadData.UploadId&&n.removeUsing(e.UploadData.UploadId),r.UploadId=e.UploadData.UploadId||"",i.logger.error({cate:"RESULT",tag:"upload",msg:"[key=".concat(e.Key,"] 分块上传失败: ").concat(JSON.stringify(r))}),t(r)})),c.on("upload_complete",(function(r){var o=s.extend({UploadId:e.UploadData.UploadId||""},r);t(null,o)})),c.on("upload_slice_complete",(function(t){var a={};s.each(e.Headers,(function(e,t){var r=t.toLowerCase();(0===r.indexOf("x-cos-meta-")||["pic-operations","x-cos-callback","x-cos-callback-var","x-cos-return-body"].includes(r))&&(a[t]=e)})),i.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 开始完成分块请求")}),h.call(i,{Bucket:d,Region:f,Key:g,UploadId:t.UploadId,SliceList:t.SliceList,Headers:a,tracker:S},(function(a,s){if(i._isRunningTask(l)){if(n.removeUsing(t.UploadId),a)return o(null,!0),i.logger.error({cate:"RESULT",tag:"upload",msg:"[key=".concat(e.Key,"] 完成分块请求失败")}),c.emit("error",a);n.removeUploadId.call(i,t.UploadId),o({loaded:r,total:r},!0),i.logger.info({cate:"RESULT",tag:"upload",msg:"[key=".concat(e.Key,"] 完成分块请求成功")}),c.emit("upload_complete",s)}}))})),c.on("get_upload_data_finish",(function(t){var a=n.getFileId(m,e.ChunkSize,d,g);a&&n.saveUploadId.call(i,a,t.UploadId,i.options.UploadIdCacheLimit),n.setUsing(t.UploadId),o(null,!0),i.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 开始上传各个分块")}),p.call(i,{TaskId:l,Bucket:d,Region:f,Key:g,Body:m,FileSize:r,SliceSize:y,AsyncLimit:k,ServerSideEncryption:v,UploadData:t,Headers:e.Headers,onProgress:o,tracker:S},(function(t,r){if(i._isRunningTask(l)){if(t)return o(null,!0),i.logger.error({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 分块上传失败")}),c.emit("error",t);i.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 所有分块上传完成")}),c.emit("upload_slice_complete",r)}}))})),c.on("get_file_size_finish",(function(){if(o=s.throttleOnProgress.call(i,r,e.onProgress),e.UploadData.UploadId)i.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 已经获取到 uploadId, ").concat(e.UploadData.UploadId)}),c.emit("get_upload_data_finish",e.UploadData);else{var t=s.extend({TaskId:l,Bucket:d,Region:f,Key:g,Headers:e.Headers,StorageClass:C,Body:m,FileSize:r,SliceSize:y,onHashProgress:b,tracker:S},e);i.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 去获取 uploadId")}),u.call(i,t,(function(t,r){if(i._isRunningTask(l)){if(t)return c.emit("error",t);e.UploadData.UploadId=r.UploadId,e.UploadData.PartList=r.PartList,i.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 获取到 uploadId, ").concat(e.UploadData.UploadId)}),c.emit("get_upload_data_finish",e.UploadData)}}))}})),r=e.ContentLength,delete e.ContentLength,!e.Headers&&(e.Headers={}),s.each(e.Headers,(function(t,r){"content-length"===r.toLowerCase()&&delete e.Headers[r]})),function(){for(var t=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,5120],o=1048576,n=0;n<t.length&&!(r/(o=1024*t[n]*1024)<=i.options.MaxPartNumber);n++);e.ChunkSize=e.SliceSize=y=Math.max(y,o)}(),0===r?(e.Body="",e.ContentLength=0,e.SkipTask=!0,i.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 文件大小为 0，执行简单上传")}),i.putObject(e,t)):c.emit("get_file_size_finish")},abortUploadTask:function(e,t){var r=e.Bucket,o=e.Region,n=e.Key,i=e.UploadId,c=e.Level||"task",u=e.AsyncLimit,d=this,p=new a;if(p.on("error",(function(e){return t(e)})),p.on("get_abort_array",(function(i){g.call(d,{Bucket:r,Region:o,Key:n,Headers:e.Headers,AsyncLimit:u,AbortArray:i},t)})),"bucket"===c)l.call(d,{Bucket:r,Region:o,calledBySdk:"abortUploadTask"},(function(e,r){if(e)return t(e);p.emit("get_abort_array",r.UploadList||[])}));else if("file"===c){if(!n)return t(s.error(new Error("abort_upload_task_no_key")));l.call(d,{Bucket:r,Region:o,Key:n,calledBySdk:"abortUploadTask"},(function(e,r){if(e)return t(e);p.emit("get_abort_array",r.UploadList||[])}))}else{if("task"!==c)return t(s.error(new Error("abort_unknown_level")));if(!i)return t(s.error(new Error("abort_upload_task_no_id")));if(!n)return t(s.error(new Error("abort_upload_task_no_key")));p.emit("get_abort_array",[{Key:n,UploadId:i}])}},uploadFile:function(e,t){var r=this,n=void 0===e.SliceSize?r.options.SliceSize:e.SliceSize,i=[],a=e.Body,u=a.size||a.length||0,l={TaskId:""};if(r.options.EnableReporter){var d=r.options.UseAccelerate||"string"==typeof r.options.Domain&&r.options.Domain.includes("accelerate."),p=u>n?"sliceUploadFile":"putObject";e.tracker=new c({Beacon:r.options.BeaconReporter,clsReporter:r.options.ClsReporter,bucket:e.Bucket,region:e.Region,apiName:"uploadFile",realApi:p,fileKey:e.Key,fileSize:u,accelerate:d,deepTracker:r.options.DeepTracker,customId:r.options.CustomId,delay:r.options.TrackerDelay})}s.each(e,(function(e,t){"object"!==o(e)&&"function"!=typeof e&&(l[t]=e)}));var f=e.onTaskReady;e.onTaskReady=function(e){l.TaskId=e,f&&f(e)};var h=u>n?"sliceUploadFile":"putObject",g=e.onFileFinish;i.push({api:h,params:e,callback:function(r,o){e.tracker&&e.tracker.report(r,o),g&&g(r,o,l),t&&t(r,o)}}),r._addTasks(i)},uploadFiles:function(e,t){var r=this,n=void 0===e.SliceSize?r.options.SliceSize:e.SliceSize,i=0,a=0,u=s.throttleOnProgress.call(r,a,e.onProgress),l=e.files.length,d=e.onFileFinish,p=Array(l),f=function(e,r,o){u(null,!0),d&&d(e,r,o),p[o.Index]={options:o,error:e,data:r},--l<=0&&t&&t(null,{files:p})},h=[];s.each(e.files,(function(e,t){!function(){var l=e.Body,d=l.size||l.length||0,p={Index:t,TaskId:""};if(!r.options.UseRawKey&&e.Key&&"/"===e.Key.substr(0,1)&&(e.Key=e.Key.substr(1)),i+=d,r.options.EnableReporter){var g=r.options.UseAccelerate||"string"==typeof r.options.Domain&&r.options.Domain.includes("accelerate."),m=d>n?"sliceUploadFile":"putObject";e.tracker=new c({Beacon:r.options.BeaconReporter,clsReporter:r.options.ClsReporter,bucket:e.Bucket,region:e.Region,apiName:"uploadFiles",realApi:m,fileKey:e.Key,fileSize:d,accelerate:g,deepTracker:r.options.DeepTracker,customId:r.options.CustomId,delay:r.options.TrackerDelay})}s.each(e,(function(e,t){"object"!==o(e)&&"function"!=typeof e&&(p[t]=e)}));var y=e.onTaskReady;e.onTaskReady=function(e){p.TaskId=e,y&&y(e)};var k=0,C=e.onProgress;e.onProgress=function(e){a=a-k+e.loaded,k=e.loaded,C&&C(e),u({loaded:a,total:i})};var v=d>n?"sliceUploadFile":"putObject",b=e.onFileFinish;h.push({api:v,params:e,callback:function(t,r){e.tracker&&e.tracker.report(t,r),b&&b(t,r),f&&f(t,r,p)}})}()})),r._addTasks(h)},sliceCopyFile:function(e,t){var r=new a,o=this,c=e.Bucket,u=e.Region,l=e.Key,p=e.CopySource,f=s.getSourceParams.call(this,p);if(f){var h=f.Bucket,g=f.Region,y=decodeURIComponent(f.Key),k=void 0===e.CopySliceSize?o.options.CopySliceSize:e.CopySliceSize;k=Math.max(0,k);var C,v,b=e.CopyChunkSize||this.options.CopyChunkSize,S=this.options.CopyChunkParallelLimit,R=this.options.ChunkRetryTimes+1,x=0,T=0,B={},A={},E={};r.on("copy_slice_complete",(function(r){var a={};s.each(e.Headers,(function(e,t){0===t.toLowerCase().indexOf("x-cos-meta-")&&(a[t]=e)}));var d=s.map(r.PartList,(function(e){return{PartNumber:e.PartNumber,ETag:e.ETag}}));i.retry(R,(function(t){o.multipartComplete({Bucket:c,Region:u,Key:l,UploadId:r.UploadId,Parts:d,tracker:e.tracker,calledBySdk:"sliceCopyFile"},t)}),(function(e,o){if(n.removeUsing(r.UploadId),e)return v(null,!0),t(e);n.removeUploadId(r.UploadId),v({loaded:C,total:C},!0),t(null,o)}))})),r.on("get_copy_data_finish",(function(a){var d=n.getCopyFileId(p,B,b,c,l);d&&n.saveUploadId(d,a.UploadId,o.options.UploadIdCacheLimit),n.setUsing(a.UploadId);var f=s.filter(a.PartList,(function(e){return e.Uploaded&&(T+=e.PartNumber>=x&&C%b||b),!e.Uploaded}));i.eachLimit(f,S,(function(t,r){var n=t.PartNumber,s=t.CopySourceRange,d=t.end-t.start;i.retry(R,(function(t){m.call(o,{Bucket:c,Region:u,Key:l,CopySource:p,UploadId:a.UploadId,PartNumber:n,CopySourceRange:s,tracker:e.tracker,calledBySdk:"sliceCopyFile"},t)}),(function(e,o){if(e)return r(e);v({loaded:T+=d,total:C}),t.ETag=o.ETag,r(e||null,o)}))}),(function(e){if(e)return n.removeUsing(a.UploadId),v(null,!0),t(e);r.emit("copy_slice_complete",a)}))})),r.on("get_chunk_size_finish",(function(){var i=function(){o.multipartInit({Bucket:c,Region:u,Key:l,Headers:E,tracker:e.tracker,calledBySdk:"sliceCopyFile"},(function(o,n){if(o)return t(o);e.UploadId=n.UploadId,r.emit("get_copy_data_finish",{UploadId:e.UploadId,PartList:e.PartList})}))},a=n.getCopyFileId(p,B,b,c,l),f=n.getUploadIdList(a);if(!a||!f)return i();var h=function(t){if(t>=f.length)return i();var a=f[t];if(n.using[a])return h(t+1);d.call(o,{Bucket:c,Region:u,Key:l,UploadId:a,tracker:e.tracker,calledBySdk:"sliceCopyFile"},(function(o,i){if(o)n.removeUploadId(a),h(t+1);else{if(n.using[a])return h(t+1);var c={},u=0;s.each(i.PartList,(function(e){var t=parseInt(e.Size),r=u+t-1;c[e.PartNumber+"|"+u+"|"+r]=e.ETag,u+=t})),s.each(e.PartList,(function(e){var t=c[e.PartNumber+"|"+e.start+"|"+e.end];t&&(e.ETag=t,e.Uploaded=!0)})),r.emit("get_copy_data_finish",{UploadId:a,PartList:e.PartList})}}))};h(0)})),r.on("get_file_size_finish",(function(){if(function(){for(var t=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,5120],r=1048576,n=0;n<t.length&&!(C/(r=1024*t[n]*1024)<=o.options.MaxPartNumber);n++);e.ChunkSize=b=Math.max(b,r),x=Math.ceil(C/b);for(var i=[],a=1;a<=x;a++){var s=(a-1)*b,c=a*b<C?a*b-1:C-1,u={PartNumber:a,start:s,end:c,CopySourceRange:"bytes="+s+"-"+c};i.push(u)}e.PartList=i}(),(E="Replaced"===e.Headers["x-cos-metadata-directive"]?e.Headers:A)["x-cos-storage-class"]=e.Headers["x-cos-storage-class"]||A["x-cos-storage-class"],E=s.clearKey(E),"ARCHIVE"===A["x-cos-storage-class"]||"DEEP_ARCHIVE"===A["x-cos-storage-class"]){var n=A["x-cos-restore"];if(!n||'ongoing-request="true"'===n)return void t(s.error(new Error("Unrestored archive object is not allowed to be copied")))}delete E["x-cos-copy-source"],delete E["x-cos-metadata-directive"],delete E["x-cos-copy-source-If-Modified-Since"],delete E["x-cos-copy-source-If-Unmodified-Since"],delete E["x-cos-copy-source-If-Match"],delete E["x-cos-copy-source-If-None-Match"],r.emit("get_chunk_size_finish")})),o.headObject({Bucket:h,Region:g,Key:y,tracker:e.tracker,calledBySdk:"sliceCopyFile"},(function(n,i){if(n)n.statusCode&&404===n.statusCode?t(s.error(n,{ErrorStatus:y+" Not Exist"})):t(n);else if(void 0!==(C=e.FileSize=i.headers["content-length"])&&C)if(e.tracker&&e.tracker.setParams({httpSize:C}),v=s.throttleOnProgress.call(o,C,e.onProgress),C<=k)e.Headers["x-cos-metadata-directive"]||(e.Headers["x-cos-metadata-directive"]="Copy"),o.putObjectCopy(Object.assign(e,{calledBySdk:"sliceCopyFile"}),(function(e,r){if(e)return v(null,!0),t(e);v({loaded:C,total:C},!0),t(e,r)}));else{var a=i.headers;B=a,A={"Cache-Control":a["cache-control"],"Content-Disposition":a["content-disposition"],"Content-Encoding":a["content-encoding"],"Content-Type":a["content-type"],Expires:a.expires,"x-cos-storage-class":a["x-cos-storage-class"]},s.each(a,(function(e,t){var r="x-cos-meta-";0===t.indexOf(r)&&t.length>11&&(A[t]=e)})),r.emit("get_file_size_finish")}else t(s.error(new Error('get Content-Length error, please add "Content-Length" to CORS ExposeHeader setting.（ 获取Content-Length失败，请在CORS ExposeHeader设置中添加Content-Length，请参考文档：https://cloud.tencent.com/document/product/436/13318 ）')))}))}else t(s.error(new Error("CopySource format error")))}};e.exports.init=function(e,t){t.transferToTaskMethod(y,"sliceUploadFile"),s.each(y,(function(t,r){e.prototype[r]=s.apiWrapper(r,t)}))}},function(e,t){var r={eachLimit:function(e,t,r,o){if(o=o||function(){},!e.length||t<=0)return o();var n=0,i=0,a=0;!function s(){if(n>=e.length)return o();for(;a<t&&i<e.length;)a+=1,r(e[(i+=1)-1],(function(t){t?(o(t),o=function(){}):(a-=1,(n+=1)>=e.length?o():s())}))}()},retry:function(e,t,r){var o=function(n){t((function(t,i){t&&n<e?o(n+1):r(t,i)}))};e<1?r():o(1)}};e.exports=r},function(e,t,r){var o=r(8),n=r(9),i=r(13),a=r(3).version,s=["VERBOSE","DEBUG","INFO","WARN","ERROR"],c=function(){"use strict";return n((function e(t){var r;o(this,e),i(this,"level","VERBOSE"),i(this,"clsLogger",null),i(this,"logExtras",{}),this.enableLog=null!==(r=t.enableLog)&&void 0!==r&&r,this.level=t.level||"VERBOSE",s.includes(this.level)||(this.level="VERBOSE"),this.enableLogcat=t.enableLogcat,this.clsLogger=t.clsLogger,this.logExtras=t.logExtras}),[{key:"info",value:function(){if(["VERBOSE","INFO"].includes(this.level)){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,["info"].concat(t))}}},{key:"debug",value:function(){if(["VERBOSE","DEBUG"].includes(this.level)){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,["debug"].concat(t))}}},{key:"warn",value:function(){if(["VERBOSE","WARN"].includes(this.level)){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,["warn"].concat(t))}}},{key:"error",value:function(){if(["VERBOSE","ERROR"].includes(this.level)){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,["error"].concat(t))}}},{key:"log",value:function(){if(this.enableLog){var e=arguments.length<=1?void 0:arguments[1],t=e.cate,r=void 0===t?"base":t,o=e.tag,n=void 0===o?"base":o,i=e.msg,s={version:"cos-js-sdk-v5-".concat(a),timestamp:(new Date).toISOString(),cate:"[".concat(r.toUpperCase(),"]"),tag:"[".concat(n.toUpperCase(),"]"),msg:i,extras:this.logExtras};this.enableLogcat,this.clsLogger&&this.clsLogger.log(s,!1),this.emit("log-message",s)}}}])}();e.exports=c}])}));